<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DB Pro Master v24.21 (Platinum)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* [ìŠ¤íƒ€ì¼ ì‹œíŠ¸ v24.21] */
        :root { 
            --primary: #2563eb; 
            --primary-dark: #1e40af; 
            --bg-light: #f1f5f9; 
            --border: #e2e8f0; 
            --text: #334155; 
            --danger: #ef4444; 
            --success: #10b981; 
            --prospect: #8b5cf6; 
            --warning: #f59e0b;
        }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; margin: 0; background: var(--bg-light); color: var(--text); height: 100vh; display: flex; overflow: hidden; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .btn { padding: 10px 16px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 6px; justify-content: center; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn:active { transform: translateY(0); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-danger { background: #fee2e2; color: var(--danger); }
        .btn-danger:hover { background: #fecaca; }
        .btn-dark { background: #1e293b; color: white; }
        .btn-secondary { background: white; border: 1px solid #cbd5e1; color: #64748b; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }

        input, select, textarea { font-family: inherit; }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="date"] { cursor: pointer; position: relative; }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); 
        }

        #hist-input { padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; transition: 0.2s; }
        #hist-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 24px; width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .login-input { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; margin-bottom: 15px; font-size: 16px; transition: 0.2s; }
        .login-input:focus { border-color: var(--primary); }

        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 10001; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: white; padding: 16px 20px; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; animation: slideInRight 0.3s forwards; pointer-events: auto; border-left: 5px solid var(--primary); min-width: 300px; }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

        .sidebar { width: 260px; background: white; border-right: 1px solid var(--border); padding: 24px; display: flex; flex-direction: column; z-index: 50; transition: 0.3s; }
        .sidebar.admin-mode { background: linear-gradient(160deg, #0f172a 0%, #1e293b 100%); color: white; border: none; }
        .logo-area { font-size: 20px; font-weight: 900; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
        .sidebar.admin-mode .logo-area { color: white; }
        
        .btn-big-action { width: 100%; padding: 14px; border-radius: 12px; border: none; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 10px; transition: 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .btn-new-db { background: var(--primary); color: white; }
        .btn-new-db:hover { background: var(--primary-dark); }
        
        .nav-item { padding: 12px 14px; margin-bottom: 6px; border-radius: 10px; cursor: pointer; color: #64748b; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: #eff6ff; color: var(--primary); }
        .sidebar.admin-mode .nav-item { color: #94a3b8; }
        .sidebar.admin-mode .nav-item:hover, .sidebar.admin-mode .nav-item.active { background: rgba(255,255,255,0.1); color: white; }
        
        .sidebar.admin-mode .profile-box { background: rgba(255,255,255,0.1) !important; border-color: rgba(255,255,255,0.2) !important; }
        .sidebar.admin-mode #profile-name { color: white !important; }
        .sidebar.admin-mode #profile-role { color: #cbd5e1 !important; }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .header { height: 64px; background: white; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .page-content { flex: 1; overflow-y: auto; padding: 30px; }
        .card { background: white; border-radius: 16px; padding: 24px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.02); }
        
        .table-container { overflow-x: auto; background: white; border-radius: 12px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; }
        th { background: #f8fafc; padding: 12px 16px; text-align: center; color: #64748b; font-weight: 700; border-bottom: 1px solid var(--border); font-size: 12px; text-transform: uppercase; }
        td { padding: 14px 16px; border-bottom: 1px solid var(--border); color: #333; text-align: center; font-weight: 500; }
        tr:hover { background-color: #f8fafc; cursor: pointer; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; }
        .status-wait { background: #f1f5f9; color: #64748b; }
        .status-ing { background: #dbeafe; color: #2563eb; }
        .status-prospect { background: #f3e8ff; color: #7c3aed; }
        .status-done { background: #dcfce7; color: #16a34a; }
        .status-end { background: #fee2e2; color: #dc2626; }
        .status-share { background: #ffedd5; color: #c2410c; }

        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 24px; border-radius: 16px; display: flex; flex-direction: column; justify-content: space-between; border-left: 5px solid var(--primary); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .stat-label { font-size: 13px; color: #64748b; font-weight: 700; margin-bottom: 8px; }
        .stat-value { font-size: 24px; font-weight: 800; color: #1e293b; }
        .rank-card { flex:1; background:white; border-radius:12px; padding:20px; border:1px solid #e2e8f0; }
        .rank-title { font-weight:800; font-size:15px; margin-bottom:15px; display:flex; align-items:center; gap:8px; }
        .rank-list { list-style:none; padding:0; margin:0; }
        .rank-item { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f1f5f9; font-size:14px; }
        .rank-val { font-weight:bold; color:var(--primary); }
        
        .progress-bar-bg { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; width: 100px; margin: 5px auto 0; }
        .progress-bar-fill { height: 100%; background: var(--primary); border-radius: 4px; transition: width 0.3s ease; }

        .compare-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .compare-box { flex: 1; background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0; }
        .compare-val { font-size: 24px; font-weight: 800; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(2px); }
        .modal-window { background: white; width: 1200px; height: 95vh; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .modal-header { padding: 20px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #fff; }
        
        .modal-body { flex: 1; display: flex; overflow: hidden; background: #f8fafc; }
        .panel-left { flex: 7; padding: 30px; overflow-y: auto; border-right: 1px solid var(--border); }
        .panel-right { flex: 3; padding: 30px; display: flex; flex-direction: column; background: white; }
        
        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        .form-group label { display: block; font-size: 12px; font-weight: 700; color: #64748b; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; transition: 0.2s; }
        
        .dynamic-section { display: none; background: white; border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-top: 15px; }
        .dynamic-section.active { display: block; animation: fadeIn 0.3s; }
        .contract-box { background: #ecfdf5; border-color: #6ee7b7; }
        .prospect-box { background: #f3e8ff; border-color: #d8b4fe; }
        
        .share-info { background: #fffbeb; border: 1px solid #fcd34d; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 13px; }
        .share-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .share-row select { flex: 2; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; }
        .share-row input { width: 70px; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; text-align: right; }
        .share-val { min-width: 80px; text-align: right; font-weight: bold; color: var(--primary); }

        .meeting-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; }
        .meeting-today { background: #fef3c7; color: #d97706; }
        .meeting-upcoming { background: #dbeafe; color: #2563eb; }
        .meeting-overdue { background: #fee2e2; color: #dc2626; }

        /* ë¡œë“œë§µ */
        #roadmap-modal .modal-window { width: 1400px; height: 95vh; }
        #roadmap-modal .modal-body { display: block; padding: 30px; overflow-y: auto; }
        .roadmap-toolbar { background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .roadmap-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
        .btn-preset { padding: 8px 14px; font-size: 13px; background: white; color: #475569; border: 1px solid #cbd5e1; border-radius: 20px; cursor: pointer; font-weight: 600; }
        .btn-preset.active { background: #eff6ff; color: var(--primary); border-color: var(--primary); }
        .rm-input-row { display: flex; gap: 10px; align-items: center; background: white; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; }
        .rm-input-row.edit-mode { border: 2px solid var(--primary); background: #eff6ff; }
        .rm-input-group { display: flex; flex-direction: column; gap: 5px; }
        .rm-container { border: 2px solid #334155; padding: 30px; border-radius: 15px; margin-bottom: 20px; background: white; overflow-x: auto; }
        .rm-table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 12px; }
        .rm-header { background: #1e3a8a; color: white; padding: 12px 0; border: 1px solid #94a3b8; font-weight:bold; text-align:center; }
        .rm-subheader { background: #3b82f6; color: white; padding: 6px 0; border: 1px solid #94a3b8; font-size:11px; text-align:center; }
        .rm-cell { border: 1px solid #cbd5e1; height: 55px; position: relative; background: white; }
        .rm-cat-col { width: 120px; text-align: center; font-weight: 800; border: 1px solid #94a3b8; color: white; padding: 5px; word-break: keep-all; vertical-align: middle; }
        .rm-diagonal { background: linear-gradient(to top right, #f1f5f9 49.5%, #94a3b8 50%, #f1f5f9 50.5%); position: relative; }
        .rm-diagonal-text { position: absolute; font-size: 11px; font-weight: bold; color: #334155; }
        .rm-text-bottom-left { bottom: 5px; left: 8px; }
        .rm-text-top-right { top: 5px; right: 8px; }
        .rm-bar-container { position: absolute; top: 10px; bottom: 10px; border-radius: 15px; display: flex; align-items: center; color: white; font-size: 12px; font-weight: bold; box-shadow: 2px 3px 6px rgba(0,0,0,0.15); overflow: hidden; z-index: 10; cursor: pointer; white-space: nowrap; }
        .rm-align-left { justify-content: flex-start; padding-left: 10px; }
        .rm-align-center { justify-content: center; }
        .rm-align-right { justify-content: flex-end; padding-right: 10px; }
        .rm-bar-outer-text { position: absolute; top: 50%; transform: translateY(-50%); left: 105%; margin-left: 8px; font-size: 11px; font-weight: bold; color: #334155; z-index: 5; white-space: nowrap; }
        .rm-item-chip { display:inline-flex; background:#f1f5f9; padding:6px 12px; margin:3px; border-radius:20px; border:1px solid #cbd5e1; font-size:13px; cursor:grab; align-items:center; }
        .rm-item-chip.drag-over { border-left: 3px solid var(--primary); background: #eff6ff; }
        .rm-title-edit { font-size: 32px; font-weight: 900; text-align: center; margin-bottom: 40px; border: 2px dashed transparent; display: block; font-family:'Pretendard'; color:#1e293b; outline:none; }
        .rm-title-edit:hover { border-color: #cbd5e1; background: #f8fafc; }
        .bg-grad-0 { background: #0f172a; } .bg-grad-1 { background: #1e3a8a; } .bg-grad-2 { background: #1d4ed8; } .bg-grad-3 { background: #3b82f6; } .bg-grad-4 { background: #60a5fa; } .bg-grad-5 { background: #93c5fd; color:#1e293b!important; }

        @media print {
            body * { visibility: hidden; }
            #roadmap-print-area, #roadmap-print-area * { visibility: visible; }
            #roadmap-print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .rm-container { border: none !important; padding: 0 !important; }
            /* [â˜…ì¤‘ìš”] ì¸ì‡„ ì‹œ ë°°ê²½ìƒ‰ ê°•ì œ ì ìš© */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); width: 280px; box-shadow: none; }
            .sidebar.active { transform: translateX(0); box-shadow: 100px 0 0 rgba(0,0,0,0.5); }
            .main-content { width: 100%; height: auto; overflow: visible; }
            .page-content { padding: 15px; overflow: visible; padding-bottom: 80px; }
            .header { padding: 0 15px; }
            #mobile-menu-btn { display: block !important; font-size: 24px; cursor: pointer; color: #334155; }
            .login-box { width: 90%; padding: 25px; }
            .dashboard-grid, .form-grid { grid-template-columns: 1fr; gap: 10px; }
            .compare-row, #list-filter-container { flex-direction: column; }
            
            .modal-window { width: 100% !important; height: 100% !important; border-radius: 0; top: 0; left: 0; }
            .modal-body { flex-direction: column; overflow-y: auto; padding: 0; }
            .panel-left, .panel-right { width: 100%; padding: 15px; border: none; flex: none; overflow-y: visible; max-height: none; }
            .panel-right { border-top: 4px solid #f1f5f9; padding-top: 20px; margin-top: 0; padding-bottom: 100px; }
            
            .rm-input-row { flex-direction: column; align-items: stretch; }
            #roadmap-modal .modal-window { width: 100% !important; height: 100% !important; }
            #roadmap-modal .modal-body { padding: 15px; padding-bottom: 100px; }
        }
    </style>
</head>
<body>

<div id="toast-container"></div>
<div id="loading-overlay"><div class="spinner"></div></div>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color:var(--primary); margin-bottom:10px;"><i class="fa-solid fa-server"></i> DB Pro Master</h2>
        <div style="font-size:14px; color:#64748b; margin-bottom:20px; font-weight:600;">v24.21 Platinum</div>
        <div id="login-loading" style="display:none; text-align:center; margin-bottom:15px; color:var(--primary);"><i class="fa-solid fa-spinner fa-spin" style="font-size:24px;"></i><br><span style="font-size:12px; font-weight:600;">ì ‘ì† ì¤‘...</span></div>
        <input type="text" id="login-user-name" class="login-input" placeholder="ì„±í•¨ ì…ë ¥ (ì˜ˆ: í™ê¸¸ë™)" onkeypress="if(event.keyCode==13) document.getElementById('login-pw').focus()">
        <input type="password" id="login-pw" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeypress="if(event.keyCode==13) attemptLogin('member')">
        <div style="text-align: left; margin-bottom: 20px; padding-left: 5px;">
            <label style="font-size: 14px; color: #64748b; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="login-remember" style="width: 18px; height: 18px; cursor: pointer;"> ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
            </label>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn btn-primary" style="padding:15px; font-size:16px;" onclick="attemptLogin('member')">íŒ€ì› ì ‘ì†í•˜ê¸°</button>
            <button class="btn btn-dark" style="padding:15px; font-size:16px;" onclick="attemptLogin('admin')">ê´€ë¦¬ì ì ‘ì†í•˜ê¸°</button>
        </div>
        <p style="margin-top:25px; font-size:12px; color:#94a3b8; line-height:1.5;">* ì´ˆê¸° ë¹„ë²ˆ : 1234<br><span style="color:#ef4444; font-weight:bold;">âš ï¸ ìµœì´ˆ ë¡œê·¸ì¸ í›„ ë°˜ë“œì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”!</span></p>
    </div>
</div>

<div class="sidebar" id="app-sidebar" style="display:none;">
    <div class="logo-area"><i class="fa-solid fa-layer-group"></i> DB Master</div>
    <button class="btn-big-action btn-new-db" onclick="openModal(); toggleMobileMenu();"><i class="fa-solid fa-plus"></i> ì‹ ê·œ DB ë“±ë¡</button>
    <div id="nav-members" class="nav-item" style="display:none;" onclick="navTo('members'); toggleMobileMenu();"><i class="fa-solid fa-users-gear"></i> íŒ€ì› ëª…ë‹¨ ê´€ë¦¬</div>

    <div class="profile-box" style="background:#f8fafc; padding:15px; border-radius:12px; margin: 15px 0; border:1px solid #e2e8f0;">
        <div id="profile-name" style="font-weight:bold; font-size:16px; color:#1e293b;"></div>
        <div style="font-size:12px; opacity:0.7; margin-top:4px; color:#64748b;" id="profile-role"></div>
        <button onclick="changePassword()" style="margin-top:10px; font-size:11px; padding:4px 10px; border:1px solid #cbd5e1; background:white; border-radius:6px; cursor:pointer; color:#333;">ë¹„ë²ˆë³€ê²½</button>
    </div>

    <div id="nav-list" class="nav-item active" onclick="navTo('list'); toggleMobileMenu();"><i class="fa-solid fa-folder-open"></i> <span id="menu-list-text">ë‚˜ì˜ DB ê´€ë¦¬</span></div>
    <div id="nav-analysis" class="nav-item" onclick="navTo('analysis'); toggleMobileMenu();"><i class="fa-solid fa-chart-column"></i> ì‹¤ì  ìƒì„¸ ë¶„ì„</div>
    <div id="nav-history" class="nav-item" onclick="navTo('history'); toggleMobileMenu();"><i class="fa-solid fa-calendar-days"></i> <span id="menu-hist-text">ì›”ë³„ íˆìŠ¤í† ë¦¬</span></div>
    <div id="admin-menu" style="display:none; margin-top:20px;">
        <div style="font-size:11px; opacity:0.7; font-weight:bold; padding-left:10px; margin-bottom:5px;">ê´€ë¦¬ì ì „ìš©</div>
        <div id="nav-dashboard" class="nav-item" onclick="navTo('dashboard'); toggleMobileMenu();"><i class="fa-solid fa-tower-observation"></i> í†µí•© ê´€ì œíƒ‘</div>
    </div>
    <button onclick="logout()" style="margin-top:auto; background:none; border:none; color:#ef4444; font-weight:bold; cursor:pointer; display:flex; align-items:center; gap:5px;"><i class="fa-solid fa-right-from-bracket"></i> ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div id="mobile-sidebar-overlay" onclick="toggleMobileMenu()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:40;"></div>

<div class="main-content" id="app-main" style="display:none;">
    <div class="header">
        <div style="display:flex; align-items:center; gap:15px;">
            <i class="fa-solid fa-bars" id="mobile-menu-btn" style="display:none; cursor:pointer;" onclick="toggleMobileMenu()"></i>
            <h2 id="page-title" style="font-size:18px; font-weight:800; margin:0;">ë‚˜ì˜ DB ê´€ë¦¬</h2>
        </div>
        <div style="display:flex; align-items:center; gap:10px;">
            <div id="meeting-alert-badge" style="display:none;"></div>
            <div style="font-size:12px; color:#64748b; font-weight:bold; background:#f1f5f9; padding:6px 12px; border-radius:20px;">v24.21</div>
        </div>
    </div>

    <div class="page-content" id="view-list">
        <div class="card" style="padding:20px;">
            <div id="list-filter-container" style="display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;"></div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-size:13px; color:#64748b; display:flex; align-items:center; gap:6px;">
                    <i class="fa-solid fa-circle-info" style="color:var(--primary);"></i> ì‰ì–´ ë°›ì€ DBëŠ” <b>[ì´ë¦„]ì‰ì–´</b>ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                <button class="btn btn-success" onclick="exportToExcel()"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
        <div class="table-container" style="height: calc(100vh - 300px); overflow-y: auto;">
            <table id="main-table">
                <thead id="list-head"></thead>
                <tbody id="list-body"></tbody>
            </table>
            <div id="empty-message" style="display:none; text-align:center; padding:50px; color:#94a3b8;">
                <i class="fa-solid fa-folder-open" style="font-size:40px; margin-bottom:10px; opacity:0.5;"></i><br>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <div class="page-content" id="view-members" style="display:none;">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0;">ğŸ‘¥ íŒ€ì› ëª…ë‹¨ ê´€ë¦¬</h3>
                <button class="btn btn-primary" onclick="addTeamMember()"><i class="fa-solid fa-user-plus"></i> íŒ€ì› ì¶”ê°€</button>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>ì´ë¦„</th><th>ì§ì±…</th><th>ê´€ë¦¬</th></tr></thead>
                    <tbody id="member-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="page-content" id="view-analysis" style="display:none;">
        <div id="admin-analysis-filter" style="display:none; margin-bottom:20px; background:white; padding:15px; border-radius:12px; border:1px solid #ddd;">
            <span style="font-weight:bold; color:var(--primary);">ğŸ¯ ë¶„ì„ ëŒ€ìƒ :</span>
            <select id="analysis-target" onchange="renderAnalysisData()" style="padding:8px; border-radius:6px; font-weight:bold;"><option value="all">ğŸ¢ íšŒì‚¬ ì „ì²´</option></select>
        </div>
        <div id="admin-yoy-summary" style="display:none; margin-bottom:30px;">
            <div class="section-title" style="font-weight:800; font-size:16px; margin-bottom:15px;">ğŸ‘¥ íŒ€ì›ë³„ ì‹¤ì  ìš”ì•½</div>
            <div class="table-container"><table id="yoy-summary-table"><thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì‘ë…„ ë§¤ì¶œ</th><th>ì˜¬í•´ ë§¤ì¶œ</th><th>ì„±ì¥ì•¡</th><th>ë‹¬ì„±ë¥ </th></tr></thead><tbody></tbody></table></div>
        </div>
        <div class="section-title" style="font-weight:800; font-size:16px; margin-bottom:15px;">ğŸ“Š ì „ë…„ vs ê¸ˆë…„ ì‹¤ì  ë¹„êµ</div>
        <div class="compare-row">
            <div class="compare-box"><div class="compare-val" style="color:#64748b;" id="val-last-total">0</div><div style="font-size:12px; color:#94a3b8;">ì‘ë…„ ì´ ë§¤ì¶œ</div></div>
            <div class="compare-box" style="background:#eff6ff; border-color:#bfdbfe;"><div class="compare-val" style="color:var(--primary);" id="val-this-total">0</div><div style="font-size:12px; color:var(--primary);">ì˜¬í•´ ì´ ë§¤ì¶œ</div></div>
            <div class="compare-box"><div class="compare-val" id="val-growth">0</div><div style="font-size:12px; color:#64748b;">ì „ë…„ ëŒ€ë¹„ ì„±ì¥</div></div>
        </div>
        <div class="card"><h4>ğŸ“… ì›”ë³„ ë§¤ì¶œ ì¶”ì´ (YoY)</h4><div class="table-container"><table id="yoy-detail-table"><thead><tr><th>êµ¬ë¶„</th><th>1ì›”</th><th>2ì›”</th><th>3ì›”</th><th>4ì›”</th><th>5ì›”</th><th>6ì›”</th><th>7ì›”</th><th>8ì›”</th><th>9ì›”</th><th>10ì›”</th><th>11ì›”</th><th>12ì›”</th><th>í•©ê³„</th></tr></thead><tbody id="yoy-detail-body"></tbody></table></div></div>
        <div class="card"><h4>ğŸ“‹ ì›”ë³„ DB ì¶œì²˜ë³„ ì„±ê³¼ (ê±´ìˆ˜ / ê¸ˆì•¡)</h4><div class="table-container"><table id="month-kpi-table"><thead><tr><th>êµ¬ë¶„</th><th>1ì›”</th><th>2ì›”</th><th>3ì›”</th><th>4ì›”</th><th>5ì›”</th><th>6ì›”</th><th>7ì›”</th><th>8ì›”</th><th>9ì›”</th><th>10ì›”</th><th>11ì›”</th><th>12ì›”</th><th>í•©ê³„</th></tr></thead><tbody id="month-kpi-body"></tbody></table></div></div>
    </div>

    <div class="page-content" id="view-history" style="display:none;">
        <div class="card" style="display:flex; align-items:center; gap:15px; background:#f8fafc; border:1px solid #e2e8f0;">
            <h3 style="margin:0; font-size:16px;">ğŸ“… ì¡°íšŒ ê¸°ê°„ :</h3>
            <select id="hist-year" style="padding:8px; border-radius:6px;"></select>
            <select id="hist-month" style="padding:8px; border-radius:6px;"></select>
            <button class="btn btn-primary" onclick="renderHistory()">ì¡°íšŒí•˜ê¸°</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;" id="history-tabs"></div>
        <div class="table-container"><table><thead id="history-head"></thead><tbody id="history-body"></tbody></table></div>
    </div>

    <div class="page-content" id="view-dashboard" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0; font-weight:800;"><i class="fa-solid fa-tower-observation"></i> í†µí•© ê´€ì œíƒ‘ (Control Tower)</h3>
            <select id="admin-stat-month" style="padding:8px; border-radius:6px; font-weight:bold;" onchange="renderAdminDashboard()"></select>
        </div>
        <div class="dashboard-grid">
            <div class="stat-card"><div class="stat-label">ì´ë²ˆë‹¬ ì´ ë§¤ì¶œ (ì „ì‚¬)</div><div class="stat-value" id="ad-total-rev">0</div></div>
            <div class="stat-card" style="border-left-color:#10b981;"><div class="stat-label">ì´ë²ˆë‹¬ ì´ ê³„ì•½</div><div class="stat-value" id="ad-total-cont">0ê±´</div></div>
            <div class="stat-card" style="border-left-color:#f59e0b;"><div class="stat-label">ì´ë²ˆë‹¬ ì‹ ê·œ DB ìœ ì…</div><div class="stat-value" id="ad-total-db">0ê°œ</div></div>
            <div class="stat-card" style="border-left-color:#8b5cf6;"><div class="stat-label">ì „ì²´ ê³„ì•½ ì „í™˜ìœ¨</div><div class="stat-value" id="ad-conv-rate">0%</div></div>
        </div>
        <h3 style="margin-bottom:15px;">ğŸ† ì´ë‹¬ì˜ ëª…ì˜ˆì˜ ì „ë‹¹ (ì‹¤ì  ë‹¬ì„±)</h3>
        <div style="display:flex; gap:20px; margin-bottom:30px;">
            <div class="rank-card" style="border-top:4px solid #f59e0b;"><div class="rank-title" style="color:#b45309;"><i class="fa-solid fa-trophy"></i> 500ë§Œì› ì´ìƒ</div><ul class="rank-list" id="rank-500"></ul></div>
            <div class="rank-card" style="border-top:4px solid #10b981;"><div class="rank-title" style="color:#047857;"><i class="fa-solid fa-medal"></i> 300ë§Œì› ì´ìƒ</div><ul class="rank-list" id="rank-300"></ul></div>
            <div class="rank-card" style="border-top:4px solid #3b82f6;"><div class="rank-title" style="color:#1d4ed8;"><i class="fa-solid fa-thumbs-up"></i> 60ë§Œì› ì´ìƒ</div><ul class="rank-list" id="rank-60"></ul></div>
        </div>
        <h4 style="margin-bottom:15px;">ğŸ‘¥ íŒ€ì›ë³„ ì¢…í•© ì„±ê³¼ í˜„í™©í‘œ</h4>
        <div class="card"><div class="table-container"><table><thead><tr><th>ìˆœìœ„</th><th>íŒ€ì›ëª…</th><th>DBë°°ì •</th><th>ë¯¸íŒ…ì§„í–‰</th><th>ê°€ë§ê³ ê°</th><th>ê³„ì•½ê±´ìˆ˜</th><th>ì „í™˜ìœ¨</th><th>ì´ ë§¤ì¶œì•¡</th><th>ìƒíƒœ</th></tr></thead><tbody id="team-status-body"></tbody></table></div></div>
    </div>
</div>

<div class="modal-overlay" id="modal">
    <div class="modal-window">
        <div class="modal-header"><h3>ğŸ“ DB ì •ë³´ ìƒì„¸</h3><button onclick="closeModal()" style="border:none; background:none; font-size:24px; cursor:pointer; color:#64748b;">&times;</button></div>
        <div class="modal-body">
            <div class="panel-left">
                <input type="hidden" id="edit-id">
                <div class="card" style="margin:0 0 20px 0; border-left:4px solid var(--primary);">
                    <div class="section-label" style="color:var(--primary); font-weight:800; margin-bottom:10px;">1ë‹¨ê³„: ì—…ì²´ ê¸°ë³¸ì •ë³´</div>
                    <div style="background:#f8fafc; padding:12px; margin-bottom:15px; border-radius:8px; font-size:14px; border:1px solid #e2e8f0; display:flex; gap:10px;">
                        <span style="color:#64748b;">ë‹´ë‹¹ì:</span> <span id="display-member" style="color:#1e293b; font-weight:bold;"></span>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>ì ‘ìˆ˜ì¼</label><input type="date" id="input-date" onclick="this.showPicker()"></div>
                        <div class="form-group"><label>DB ì¶œì²˜</label><select id="input-source" onchange="updateShareFields(); toggleGradeField(); calculateShare();"><option value="íšŒì‚¬DB">ğŸ¢ íšŒì‚¬ DB</option><option value="ê°œì¸DB">ğŸ‘¤ ê°œì¸ DB</option><option value="íŒ€DB">ğŸ‘¥ íŒ€ DB</option><option value="ê¸°íƒ€DB">ğŸ¸ ê¸°íƒ€ DB</option></select></div>
                        <div class="form-group" id="group-grade-prov"><label>ì œê³µ ë“±ê¸‰ (íšŒì‚¬DB ì „ìš©)</label><select id="input-grade-prov"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select></div>
                        <div class="form-group"><label>ì—…ì²´ëª… <span style="color:red">*</span></label><input type="text" id="input-company" placeholder="í•„ìˆ˜ ì…ë ¥"></div>
                        <div class="form-group"><label>ëŒ€í‘œì</label><input type="text" id="input-ceo" placeholder="ì˜ˆ: í™ê¸¸ë™"></div>
                        <div class="form-group"><label>ì—°ë½ì²˜</label><input type="text" id="input-phone"></div>
                        <div class="form-group"><label>ì—…ì¢…</label><select id="input-industry"><option value="">ì„ íƒ</option><option value="ì œì¡°">ì œì¡°</option><option value="ê±´ì„¤">ê±´ì„¤</option><option value="ë„ì†Œë§¤">ë„ì†Œë§¤</option><option value="ì„œë¹„ìŠ¤">ì„œë¹„ìŠ¤</option><option value="IT">IT</option><option value="ìŒì‹ì ">ìŒì‹ì </option><option value="ê¸°íƒ€">ê¸°íƒ€</option></select></div>
                        <div class="form-group"><label>ë§¤ì¶œ ê·œëª¨</label><select id="input-revenue"><option value="ë¯¸í™•ì¸">ë¯¸í™•ì¸</option><option value="1ì–µë¯¸ë§Œ">1ì–µ ë¯¸ë§Œ</option><option value="1ì–µ~3ì–µ">1ì–µ ~ 3ì–µ</option><option value="3ì–µì´ìƒ">3ì–µ ì´ìƒ</option><option value="5ì–µì´ìƒ">5ì–µ ì´ìƒ</option><option value="10ì–µì´ìƒ">10ì–µ ì´ìƒ</option><option value="30ì–µì´ìƒ">30ì–µ ì´ìƒ</option></select></div>
                    </div>
                </div>
                <div class="card" style="margin:0 0 20px 0; border-left:4px solid #f59e0b;">
                    <div class="section-label" style="color:#b45309; font-weight:800; margin-bottom:10px;">2ë‹¨ê³„: ì „í™” ê²€ì¦</div>
                    <div class="form-grid">
                        <div class="form-group"><label>ëŒ€í‘œ ì‹ ìš©ì ìˆ˜</label><select id="input-credit"><option value="">ë¯¸í™•ì¸</option><option value="900ì´ìƒ">900ì  ì´ìƒ</option><option value="800ì´ìƒ">800ì  ì´ìƒ</option><option value="700ì´ìƒ">700ì  ì´ìƒ</option><option value="700ë¯¸ë§Œ">700ì  ë¯¸ë§Œ</option><option value="ì‚¬ê³ ì´ë ¥">ì‚¬ê³  ì´ë ¥</option></select></div>
                        <div class="form-group"><label>ì—°ë§¤ì¶œ (ë°±ë§Œì›)</label><input type="text" id="input-annual-rev" onkeyup="formatCurrency(this)" placeholder="ì˜ˆ: 1,000"></div>
                        <div class="form-group"><label>ì„¸ê¸ˆ ì²´ë‚©ì—¬ë¶€</label><select id="input-tax"><option value="ì™„ë‚©">ì™„ë‚©</option><option value="ë¶„ë‚©ì¤‘">ë¶„ë‚©ì¤‘</option><option value="ì—°ì²´ì¤‘">ì—°ì²´ì¤‘</option><option value="ê¸°íƒ€">ê¸°íƒ€</option></select></div>
                        <div class="form-group"><label>ì§€ì—­</label><select id="input-region"><option value="">ì„ íƒ</option><option value="ì„œìš¸">ì„œìš¸</option><option value="ê²½ê¸°">ê²½ê¸°</option><option value="ì¸ì²œ">ì¸ì²œ</option><option value="ë¶€ì‚°">ë¶€ì‚°</option><option value="ëŒ€êµ¬">ëŒ€êµ¬</option><option value="ê´‘ì£¼">ê´‘ì£¼</option><option value="ëŒ€ì „">ëŒ€ì „</option><option value="ìš¸ì‚°">ìš¸ì‚°</option><option value="ì„¸ì¢…">ì„¸ì¢…</option><option value="ê°•ì›">ê°•ì›</option><option value="ì¶©ë¶">ì¶©ë¶</option><option value="ì¶©ë‚¨">ì¶©ë‚¨</option><option value="ì „ë¶">ì „ë¶</option><option value="ì „ë‚¨">ì „ë‚¨</option><option value="ê²½ë¶">ê²½ë¶</option><option value="ê²½ë‚¨">ê²½ë‚¨</option><option value="ì œì£¼">ì œì£¼</option></select></div>
                        <div class="form-group"><label>ë¯¸íŒ… ì¼ì •</label><input type="date" id="input-meet-date" onclick="this.showPicker()"></div>
                    </div>
                </div>
                <div class="card" style="margin:0; border-left:4px solid #10b981;">
                    <div class="section-label" style="color:#047857; font-weight:800; margin-bottom:10px;">3ë‹¨ê³„: ì§„í–‰ ë° ê³„ì•½</div>
                    <div class="form-group"><label>í˜„ì¬ ìƒíƒœ</label><select id="input-status" style="padding:12px; font-weight:bold;" onchange="toggleStatusFields()"><option value="ëŒ€ê¸°">â³ ëŒ€ê¸°</option><option value="ì§„í–‰ì¤‘">ğŸƒ ì§„í–‰ì¤‘</option><option value="ê°€ë§ê³ ê°">ğŸŒŸ ê°€ë§ê³ ê°</option><option value="ê³„ì•½">ğŸ‰ ê³„ì•½</option><option value="ì¢…ë£Œ">âŒ ì¢…ë£Œ</option></select></div>
                    <div id="box-wait" class="dynamic-section"><div class="form-group"><label style="color:#64748b;">ëŒ€ê¸° ì‚¬ìœ </label><input type="text" id="input-wait-reason" placeholder="ëŒ€ê¸° ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></div></div>
                    <div id="box-ing" class="dynamic-section"><div class="form-group"><label style="color:#2563eb;">ì§„í–‰ ê³¼ì • ìƒì„¸</label><textarea id="input-ing-detail" rows="3" placeholder="ì§„í–‰ ìƒí™©ì„ ìƒì„¸íˆ ê¸°ë¡í•˜ì„¸ìš”."></textarea></div></div>
                    <div id="box-prospect" class="dynamic-section prospect-box"><div class="form-group"><label style="color:#7c3aed;">ğŸŒŸ ê°€ë§ê³ ê° ì„ ì • ì‚¬ìœ  ë° í¬ì¸íŠ¸</label><textarea id="input-prospect-detail" rows="3" placeholder="í•µì‹¬ í¬ì¸íŠ¸ì™€ ì˜ˆìƒ ê³„ì•½ ì‹œì "></textarea></div></div>
                    <div id="box-end" class="dynamic-section"><div class="form-group"><label style="color:#ef4444;">ì¢…ë£Œ/ê±°ì ˆ ì‚¬ìœ </label><input type="text" id="input-end-reason" placeholder="ì¢…ë£Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></div></div>
                    <div id="box-contract" class="dynamic-section contract-box">
                        <div class="form-grid">
                            <div class="form-group"><label>ê³„ì•½ ìƒí’ˆ</label><input type="text" id="input-product" placeholder="ì˜ˆ) êµë³´ê²½ì •"></div>
                            <div class="form-group"><label>ê³„ì•½ ê¸ˆì•¡ (ì›)</label><input type="text" id="input-amount" onkeyup="formatCurrency(this); calculateShare();" placeholder="ì½¤ë§ˆ ìë™"></div>
                        </div>
                        <div class="share-info" id="share-calculator">
                            <div style="font-weight:bold; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                                <span>ğŸ“Š ì‰ì–´ ê³„ì‚°ê¸°</span>
                                <span style="font-size:11px; color:#ef4444;">* ì‰ì–´ë°›ëŠ” íŒ€ì¥ë§Œ ì…ë ¥ (ë‚´ì‹¤ì ì€ ìë™ê³„ì‚°)</span>
                            </div>
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">1</span><select id="share-partner-1" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-1" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-1">0</span></div>
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">2</span><select id="share-partner-2" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-2" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-2">0</span></div>
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">3</span><select id="share-partner-3" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-3" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-3">0</span></div>
                            <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #e2e8f0; display:flex; justify-content:space-between; font-weight:bold;"><span>ì´ì•¡: <span id="disp-total">0</span></span><span style="color:blue;">ë‚´ ì‹¤ì : <span id="disp-net">0</span></span></div>
                        </div>
                    </div>
                    <div id="btn-roadmap-area" style="display:none; margin-top:20px;"><button class="btn btn-dark" style="width:100%; padding:15px; font-size:15px;" onclick="openRoadmapPopup()"><i class="fa-solid fa-diagram-project"></i> ğŸ“… ì»¨ì„¤íŒ… ë¡œë“œë§µ ê´€ë¦¬ (ìƒˆì°½ ì—´ê¸°)</button></div>
                    <div class="form-group" style="margin-top:15px;"><label>ìƒë‹´ë‚´ìš© ë° ì»¨ì„¤íŒ… ë°©í–¥ ê¸°ì¬</label><textarea id="input-consulting" rows="3"></textarea></div>
                </div>
            </div>
            <div class="panel-right">
                <h4>ğŸ•“ í™œë™ ë¡œê·¸</h4>
                <div style="font-size:12px; color:#64748b; margin-bottom:10px; background:#f1f5f9; padding:12px; border-radius:8px; line-height:1.5;">ì˜ˆ) 1ì°¨ ë¶€ì¬ì¤‘, 2ì°¨ í†µí™”ì—°ê²° ë“±<br>ë‚ ì§œ ê¸°ë¡ì´ í•„ìš”í•œ ëª¨ë“  ì´ìŠˆë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë‚¨ê²¨ ë†“ê¸¸ ë°”ëë‹ˆë‹¤.</div>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input type="text" id="hist-input" placeholder="ë‚´ìš© ì…ë ¥" style="flex:1;" onkeypress="if(event.keyCode==13) addLog()">
                    <button onclick="addLog()" class="btn btn-primary">ë“±ë¡</button>
                </div>
                <div id="log-list" style="flex:1; overflow-y:auto; border-top:1px solid #eee; padding-top:10px;"></div>
                <div style="margin-top:auto; display:flex; gap:5px;"><button onclick="saveData()" class="btn btn-primary" style="flex:1;">ì €ì¥</button><button onclick="deleteData()" class="btn btn-danger">ì‚­ì œ</button></div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="roadmap-modal"><div class="modal-window"><div class="modal-header"><h3><i class="fa-solid fa-diagram-project"></i> ì»¨ì„¤íŒ… ë¡œë“œë§µ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h3><button onclick="closeRoadmapPopup()" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button></div><div class="modal-body" style="background:#fff;"><div class="roadmap-toolbar" id="rm-toolbar"><div style="font-weight:800; margin-bottom:10px; color:#1e293b; display:flex; align-items:center; gap:5px;"><i class="fa-solid fa-hand-pointer"></i> ë¹ ë¥¸ í•­ëª© ì¶”ê°€</div><div class="roadmap-presets" id="rm-presets"></div><div class="rm-input-row" id="rm-input-box"><div class="rm-input-group" style="flex:2;"><span class="rm-input-label">í•­ëª©ëª…</span><input type="text" id="rm-name" placeholder="í•­ëª© ì„ íƒ" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px; font-weight:bold;"></div><div class="rm-input-group" style="flex:1;"><span class="rm-input-label">ì‹œì‘</span><select id="rm-start" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></select></div><div class="rm-input-group" style="flex:1;"><span class="rm-input-label">ì¢…ë£Œ</span><select id="rm-end" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></select></div><div class="rm-input-group" style="flex:1;"><span class="rm-input-label">ì •ë ¬</span><select id="rm-align" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"><option value="center">ê°€ìš´ë°</option><option value="left">ì¢Œì¸¡</option><option value="right">ìš°ì¸¡</option><option value="out">ë°”ê¹¥</option></select></div><div class="rm-input-group" style="flex:3;"><span class="rm-input-label">ì„¤ëª… (// ì¤„ë°”ê¿ˆ)</span><input type="text" id="rm-desc" placeholder="ë‚´ìš©" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></div><div style="display:flex; flex-direction:column; gap:5px; margin-top:auto;"><button class="btn btn-primary" id="btn-add-rm" style="height:42px;" onclick="addManualRoadmap()"><i class="fa-solid fa-plus"></i> ì¶”ê°€</button><button class="btn btn-secondary" id="btn-cancel-rm" style="height:30px; font-size:12px; display:none;" onclick="resetRoadmapInput()">ì·¨ì†Œ</button></div></div></div><div id="rm-list" style="margin-bottom:15px; font-size:13px; color:#666; min-height:30px; padding:10px; border:1px dashed #cbd5e1; border-radius:8px;"></div><div class="rm-container"><div id="roadmap-print-area"><div contenteditable="true" id="print-company-name" class="rm-title-edit" spellcheck="false">Project Schedule</div><div style="font-size:14px; color:#64748b; font-weight:normal; margin-bottom:20px; text-align:right;" id="print-member-name"></div><div style="overflow-x:auto;"><table class="rm-table"><thead><tr id="rm-header-row-1"><th class="rm-header" style="width:120px;" rowspan="2">í•­ëª©</th></tr><tr id="rm-header-row-2"></tr></thead><tbody id="rm-body"></tbody></table></div></div></div><div style="margin-top:auto; display:flex; justify-content:flex-end; gap:10px; padding-top:20px; border-top:1px solid #eee;"><button class="btn btn-primary" style="padding:15px 30px; font-size:16px;" onclick="saveRoadmap()">ì €ì¥ í›„ ë‹«ê¸°</button><button class="btn btn-dark" style="padding:15px 30px; font-size:16px;" onclick="printRoadmap()"><i class="fa-solid fa-print"></i> ë¡œë“œë§µ ì¸ì‡„</button></div></div></div></div>

<script>
    // [â˜…ì¤‘ìš”â˜…] GAS ì•± URL (ê¸°ì¡´ ì£¼ì†Œ ìœ ì§€)
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbx3BhJhRdcrZsYcEKbQwA6HSCziWhdY7gbux82bh2xdjFHZi6BFxlvhcl7er8oW2VaXGg/exec'; 
    
    // [SHA-256 í•´ì‹œ í•¨ìˆ˜]
    function sha256(ascii) {
        function rightRotate(value, amount) { return (value>>>amount) | (value<<(32 - amount)); }
        var mathPow = Math.pow; var maxWord = mathPow(2, 32); var lengthProperty = 'length'; var i, j; var result = '';
        var words = []; var asciiBitLength = ascii[lengthProperty]*8; var hash = [0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19];
        var k = [0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da, 0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070, 0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2];
        ascii += '\x80'; while (ascii[lengthProperty]%64 - 56) ascii += '\x00'; 
        for (i = 0; i < ascii[lengthProperty]; i++) { j = ascii.charCodeAt(i); if (j>>8) return; words[i>>2] |= j << ((3 - i)%4)*8; }
        words[words[lengthProperty]] = ((asciiBitLength/maxWord)|0); words[words[lengthProperty]] = (asciiBitLength);
        for (j = 0; j < words[lengthProperty];) {
            var w = words.slice(j, j += 16); var oldHash = hash; hash = hash.slice(0, 8);
            for (i = 0; i < 64; i++) {
                var i2 = i + j; var w15 = w[i - 15], w2 = w[i - 2];
                var a = hash[0], e = hash[4];
                var temp1 = hash[7] + (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) + ((e&hash[5])^((~e)&hash[6])) + k[i] + (w[i] = (i < 16) ? w[i] : (w[i - 16] + (rightRotate(w15, 7) ^ rightRotate(w15, 18) ^ (w15>>>3)) + w[i - 7] + (rightRotate(w2, 17) ^ rightRotate(w2, 19) ^ (w2>>>10)))|0);
                var temp2 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) + ((a&hash[1])^(a&hash[2])^(hash[1]&hash[2]));
                hash = [(temp1 + temp2)|0].concat(hash); hash[4] = (hash[4] + temp1)|0;
            }
            for (i = 0; i < 8; i++) { hash[i] = (hash[i] + oldHash[i])|0; }
        }
        for (i = 0; i < 8; i++) { for (j = 3; j + 1; j--) { var b = (hash[i]>>(j*8))&255; result += ((b < 16) ? 0 : '') + b.toString(16); } }
        return result;
    }

    let members = []; 
    let dbList = [];
    let currentUser = null;
    let tempLogs = [];
    let currentId = null;
    let historyTab = 'prospect';
    let isAdminLogAdded = false; 
    let tempRoadmap = []; 
    let editIndex = -1;
    let dragSrcEl = null; let dragSrcIndex = null;
    let isDragging = false; 
    const roadmapItems = ["ì‹ ë³´", "ê¸°ë³´", "ì‹ ìš©ë³´ì¦ì¬ë‹¨", "ì†Œì§„ê³µ", "ì¤‘ì§„ê³µ", "ë²•ì¸ì„¤ë¦½(ì „í™˜)", "íŠ¹í—ˆ", "ë²¤ì²˜ì¸ì¦", "ì—°êµ¬ì „ë‹´ë¶€ì„œì„¤ë¦½", "ì¬ë¬´ë“±ê¸‰ê´€ë¦¬"];
    const colorPalette = ['#0f172a', '#1e3a8a', '#1d4ed8', '#3b82f6', '#60a5fa', '#93c5fd'];

    window.onload = function() {
        fetchDB(() => {
            const lastId = localStorage.getItem('last_login_id');
            const lastPw = localStorage.getItem('last_login_pw'); 
            if(lastId && lastPw) {
                document.getElementById('login-user-name').value = lastId;
                document.getElementById('login-remember').checked = true;
                const user = members.find(m => m.name === lastId);
                if(user && user.pw === lastPw) processLoginSuccess(user);
            }
        });
        initDateSelects(); 
    };

    function showLoading() { document.getElementById('loading-overlay').style.display = 'flex'; }
    function hideLoading() { document.getElementById('loading-overlay').style.display = 'none'; }
    function showToast(msg, type='success') {
        const c = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.innerHTML = `<i class="fa-solid ${type==='success'?'fa-circle-check':'fa-circle-exclamation'}" style="color:${type==='success'?'var(--success)':'var(--danger)'}"></i> ${msg}`;
        c.appendChild(t);
        setTimeout(() => { t.style.animation='fadeOut 0.3s forwards'; setTimeout(()=>t.remove(),300); }, 3000);
    }

    function toggleMobileMenu() {
        if(window.innerWidth > 768) return;
        const sidebar = document.getElementById('app-sidebar');
        const overlay = document.getElementById('mobile-sidebar-overlay');
        if (sidebar.classList.contains('active')) { sidebar.classList.remove('active'); overlay.style.display = 'none'; } 
        else { sidebar.classList.add('active'); overlay.style.display = 'block'; }
    }

    function parseDBDate(dateStr) {
        if(!dateStr) return { year: 0, month: 0 };
        try {
            let dateObj = new Date(dateStr);
            if(!isNaN(dateObj.getTime())) {
                return { year: dateObj.getFullYear(), month: dateObj.getMonth() + 1 };
            }
            const parts = dateStr.match(/(\d{4})[\.\-\/]\s?(\d{1,2})[\.\-\/]\s?(\d{1,2})/);
            if(parts) return { year: parseInt(parts[1]), month: parseInt(parts[2]) };
        } catch(e) {}
        return { year: 0, month: 0 };
    }

    function checkMeetingAlerts() {
        if(!currentUser) return;
        const today = new Date();
        today.setHours(0,0,0,0);
        
        const myDB = currentUser.role === 'admin' ? dbList : dbList.filter(d => d.member === currentUser.name);
        let todayCount = 0;
        let upcomingCount = 0;
        
        myDB.forEach(d => {
            if(!d.meetDate || d.status === 'ê³„ì•½' || d.status === 'ì¢…ë£Œ') return;
            const meetDate = new Date(d.meetDate);
            meetDate.setHours(0,0,0,0);
            const diffDays = Math.ceil((meetDate - today) / (1000 * 60 * 60 * 24));
            
            if(diffDays === 0) todayCount++;
            else if(diffDays > 0 && diffDays <= 3) upcomingCount++;
        });
        
        const badge = document.getElementById('meeting-alert-badge');
        if(todayCount > 0) {
            badge.innerHTML = `<span class="meeting-badge meeting-today"><i class="fa-solid fa-calendar-check"></i> ì˜¤ëŠ˜ ë¯¸íŒ… ${todayCount}ê±´</span>`;
            badge.style.display = 'block';
        } else if(upcomingCount > 0) {
            badge.innerHTML = `<span class="meeting-badge meeting-upcoming"><i class="fa-solid fa-calendar"></i> ì˜ˆì • ë¯¸íŒ… ${upcomingCount}ê±´</span>`;
            badge.style.display = 'block';
        } else {
            badge.style.display = 'none';
        }
    }

    function fetchDB(callback) {
        if(!GAS_URL || GAS_URL.includes('URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”')) return showToast('URL ì„¤ì • í•„ìš”', 'error');
        document.getElementById('login-loading').style.display = 'block';
        fetch(GAS_URL).then(res => res.json()).then(data => {
            document.getElementById('login-loading').style.display = 'none';
            if (data.db) dbList = data.db; else dbList = [];
            if (data.members) members = data.members;
            dbList.sort((a, b) => {
                const dateA = new Date(a.date).getTime() || 0;
                const dateB = new Date(b.date).getTime() || 0;
                if (dateB !== dateA) return dateB - dateA;
                return (Number(b.id)||0) - (Number(a.id)||0);
            });
            if(callback) callback();
            checkMeetingAlerts();
        }).catch(err => {
            document.getElementById('login-loading').style.display = 'none';
            console.error(err);
            showToast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨', 'error');
        });
    }

    function attemptLogin(type) {
        const inputName = document.getElementById('login-user-name').value.trim();
        const inputPw = document.getElementById('login-pw').value;
        if(!inputName) return showToast("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.", 'error');
        if(!inputPw) return showToast("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", 'error');
        const user = members.find(m => m.name === inputName);
        if (!user) return showToast("ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.", 'error');
        const hashedInput = sha256(inputPw); 
        if (user.pw !== hashedInput) return showToast("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.", 'error');
        if (type === 'admin' && user.role !== 'admin') return showToast("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
        processLoginSuccess(user);
    }

    function processLoginSuccess(user) {
        currentUser = user;
        const isRemember = document.getElementById('login-remember').checked;
        if(isRemember) {
            localStorage.setItem('last_login_id', user.name);
            localStorage.setItem('last_login_pw', user.pw);
        } else {
            localStorage.removeItem('last_login_id');
            localStorage.removeItem('last_login_pw');
        }
        document.getElementById('login-screen').style.display='none';
        document.getElementById('app-sidebar').style.display='flex';
        document.getElementById('app-main').style.display='flex';
        document.getElementById('profile-name').innerText = user.name;
        document.getElementById('profile-role').innerText = user.role === 'admin' ? 'Admin Master' : 'Team Leader';
        
        if(user.role === 'admin') {
            document.getElementById('app-sidebar').classList.add('admin-mode');
            document.getElementById('admin-menu').style.display='block';
            document.getElementById('admin-yoy-summary').style.display='block';
            document.getElementById('btn-add-member').style.display='flex'; 
            document.getElementById('btn-del-member').style.display='flex';
            document.getElementById('nav-members').style.display = 'flex'; // [â˜…ìˆ˜ì •] íŒ€ì› ê´€ë¦¬ ë©”ë‰´ ë³´ì´ê¸°
            document.getElementById('page-title').innerText = 'íŒ€ì› DB ê´€ë¦¬';
        } else {
            document.getElementById('app-sidebar').classList.remove('admin-mode');
            document.getElementById('admin-menu').style.display='none';
            document.getElementById('admin-yoy-summary').style.display='none';
            document.getElementById('btn-add-member').style.display='none';
            document.getElementById('btn-del-member').style.display='none';
            document.getElementById('nav-members').style.display = 'none';
            document.getElementById('page-title').innerText = 'ë‚˜ì˜ DB ê´€ë¦¬';
        }
        setupHistoryTabs(); 
        checkMeetingAlerts();
        navTo('list');
    }

    // [â˜…ì¶”ê°€ë¨] íŒ€ì› ëª…ë‹¨ ë Œë”ë§
    function renderMemberManagement() {
        const tbody = document.getElementById('member-list-body');
        tbody.innerHTML = '';
        members.forEach(m => {
            if(m.name === 'ê´€ë¦¬ì') return; 
            tbody.innerHTML += `
                <tr>
                    <td>${m.name}</td>
                    <td>${m.role === 'admin' ? 'ê´€ë¦¬ì' : 'íŒ€ì›'}</td>
                    <td><button class="btn btn-danger" style="padding:4px 8px; font-size:12px;" onclick="deleteTeamMember('${m.name}')"><i class="fa-solid fa-trash"></i> ì‚­ì œ</button></td>
                </tr>
            `;
        });
    }

    function exportToExcel() {
        const table = document.getElementById('main-table');
        const wb = XLSX.utils.table_to_book(table, {sheet: "DB_List"});
        const dateStr = new Date().toISOString().split('T')[0]; 
        XLSX.writeFile(wb, `DB_List_${dateStr}.xlsx`);
    }

    function addTeamMember() {
        const newName = prompt("ìƒˆë¡œìš´ íŒ€ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
        if(!newName || !newName.trim()) return;
        const newPw = prompt(`'${newName}' íŒ€ì›ì˜ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”:`, "1234");
        if(!newPw) return;
        showLoading();
        fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'add_member', name: newName.trim(), pw: newPw }) })
        .then(res => res.json()).then(data => {
            hideLoading();
            if(data.result === 'success') { 
                showToast("íŒ€ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤."); 
                fetchDB(() => { if(document.getElementById('view-members').style.display === 'block') renderMemberManagement(); });
            } 
            else if(data.result === 'duplicate') { showToast("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.", 'error'); } 
            else { showToast("ì˜¤ë¥˜ ë°œìƒ", 'error'); }
        });
    }

    // [â˜…ìˆ˜ì •ë¨] deleteTeamMember (íŒŒë¼ë¯¸í„° ë°›ë„ë¡ ìˆ˜ì •)
    function deleteTeamMember(targetName) {
        const target = targetName || prompt("ì‚­ì œí•  íŒ€ì› ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:");
        if(!target) return;
        if(target === 'ê´€ë¦¬ì') return showToast("ê´€ë¦¬ìëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
        if(!confirm(`ì •ë§ '${target}' íŒ€ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní•´ë‹¹ íŒ€ì›ì˜ ëª¨ë“  DB ë°ì´í„°ëŠ” ë³´ì¡´ë˜ì§€ë§Œ ë¡œê·¸ì¸ì€ ë¶ˆê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.`)) return;
        
        showLoading();
        fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'del_member', name: target }) })
        .then(res => res.json()).then(data => {
            hideLoading();
            if(data.result === 'success') { 
                showToast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); 
                fetchDB(() => { if(document.getElementById('view-members').style.display === 'block') renderMemberManagement(); }); 
            } else { 
                showToast("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒ€ì›ì…ë‹ˆë‹¤.", 'error'); 
            }
        });
    }

    function changePassword() {
        const newPw = prompt("ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if(!newPw) return;
        if(newPw.length < 4) return showToast("ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.", 'error');
        showLoading();
        fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'change_pw', name: currentUser.name, newPw: newPw }) })
        .then(res => res.json()).then(data => {
            hideLoading();
            if(data.result === 'success') {
                showToast("ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë¡œê·¸ì¸ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.");
                const hashedNewPw = sha256(newPw);
                if(localStorage.getItem('last_login_id') === currentUser.name) localStorage.setItem('last_login_pw', hashedNewPw);
                currentUser.pw = hashedNewPw;
            } else { showToast("ë³€ê²½ ì‹¤íŒ¨", 'error'); }
        });
    }

    function toggleGradeField() { 
        document.getElementById('group-grade-prov').style.display = (document.getElementById('input-source').value === 'íšŒì‚¬DB') ? 'block' : 'none'; 
    }

    function toggleStatusFields() {
        const s = document.getElementById('input-status').value;
        document.querySelectorAll('.dynamic-section').forEach(el=>el.classList.remove('active'));
        if(s==='ëŒ€ê¸°') document.getElementById('box-wait').classList.add('active');
        if(s==='ì§„í–‰ì¤‘') document.getElementById('box-ing').classList.add('active');
        if(s==='ê°€ë§ê³ ê°') document.getElementById('box-prospect').classList.add('active');
        if(s==='ê³„ì•½') { document.getElementById('box-contract').classList.add('active'); calculateShare(); }
        if(s==='ì¢…ë£Œ') document.getElementById('box-end').classList.add('active');
        const showRoadmap = (s === 'ì§„í–‰ì¤‘' || s === 'ê³„ì•½');
        document.getElementById('btn-roadmap-area').style.display = showRoadmap ? 'block' : 'none';
    }

    // [â˜…ìˆ˜ì •ë¨] updateShareFields (ì…ë ¥ ì œí•œ ë¡œì§ ê°œì„ )
    function updateShareFields() {
        const source = document.getElementById('input-source').value;
        const currentMember = document.getElementById('display-member').innerText;
        const selectors = [1,2,3].map(i => document.getElementById(`share-partner-${i}`));
        const inputs = [1,2,3].map(i => document.getElementById(`share-percent-${i}`));
        
        let commonOptions = `<option value="">ì„ íƒ</option>`;
        members.forEach(m => { 
            if(m.role !== 'admin' && m.name !== currentMember) {
                commonOptions += `<option value="${m.name}">${m.name} íŒ€ì¥</option>`; 
            }
        });
        
        selectors.forEach((sel, idx) => {
            const currentVal = sel.value; 
            let finalOptions = commonOptions;
            
            if(source === 'íšŒì‚¬DB' && idx === 0) {
                finalOptions = `<option value="íšŒì‚¬">ğŸ¢ íšŒì‚¬</option>`;
            } else if(source === 'íŒ€DB' && idx === 0) {
                finalOptions = `<option value="SM">ğŸ—£ï¸ SM</option>`;
            } else if(source === 'íšŒì‚¬DB') {
                finalOptions = `<option value="">ì„ íƒ</option><option value="íšŒì‚¬">ğŸ¢ íšŒì‚¬</option>` + commonOptions.replace('<option value="">ì„ íƒ</option>','');
            } else if(source === 'íŒ€DB') {
                finalOptions = `<option value="">ì„ íƒ</option><option value="SM">ğŸ—£ï¸ SM</option>` + commonOptions.replace('<option value="">ì„ íƒ</option>','');
            }
            
            sel.innerHTML = finalOptions;
            sel.value = currentVal;
        });
        
        // [í•µì‹¬ ìˆ˜ì •] readOnly ë¡œì§ ì •êµí™”
        if(source === 'íšŒì‚¬DB') { 
            selectors[0].value = 'íšŒì‚¬'; selectors[0].disabled = true; 
            inputs[0].value = 10; inputs[0].readOnly = true; 
        } else if(source === 'íŒ€DB') { 
            selectors[0].value = 'SM'; selectors[0].disabled = true; 
            inputs[0].value = 30; inputs[0].readOnly = true; 
        } else { 
            selectors[0].disabled = false; 
            inputs[0].readOnly = false; // [â˜…ì¤‘ìš”] ê·¸ ì™¸ëŠ” ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ í’€ê¸°
        }
    }

    function calculateShare() {
        const total = parseInt(document.getElementById('input-amount').value.replace(/,/g,''))||0;
        let totalDeduction = 0; 
        
        for(let i=1; i<=3; i++) {
            const partnerSel = document.getElementById(`share-partner-${i}`);
            const percentIn = document.getElementById(`share-percent-${i}`);
            const valSpan = document.getElementById(`share-val-${i}`);
            const source = document.getElementById('input-source').value;
            
            if(i===1) {
                if(source==='íšŒì‚¬DB') { percentIn.value=10; partnerSel.value='íšŒì‚¬'; }
                if(source==='íŒ€DB') { percentIn.value=30; partnerSel.value='SM'; }
            }
            
            const pct = parseInt(percentIn.value) || 0;
            let shareAmt = 0;
            if(pct > 0 && partnerSel.value) { 
                shareAmt = Math.floor(total * (pct / 100)); 
            }
            valSpan.innerText = shareAmt.toLocaleString();
            valSpan.style.color = shareAmt > 0 ? '#ef4444' : '#ccc';
            totalDeduction += shareAmt;
        }
        
        document.getElementById('disp-total').innerText = total.toLocaleString();
        document.getElementById('disp-net').innerText = (total - totalDeduction).toLocaleString();
    }

    // [â˜…ìˆ˜ì •ë¨] ë¡œë“œë§µ ì¸ì‡„ í•¨ìˆ˜ (CSS í¬í•¨)
    function printRoadmap() {
        const printArea = document.getElementById('roadmap-print-area');
        const printWindow = window.open('', '_blank');
        
        // ë©”ì¸ í™”ë©´ì˜ ìŠ¤íƒ€ì¼ì„ ê°€ì ¸ì™€ì„œ ì¸ì‡„ ì°½ì— ì£¼ì…
        const styles = document.querySelector('style').innerHTML;

        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>ì»¨ì„¤íŒ… ë¡œë“œë§µ</title>
                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
                <style>
                    ${styles}
                    body { margin: 20px; background: white; -webkit-print-color-adjust: exact; }
                    .rm-container { border: none !important; padding: 0 !important; box-shadow: none; }
                    ::-webkit-scrollbar { display: none; }
                    /* ì¸ì‡„ ì‹œ ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¹€ */
                    .rm-title-edit { border: none !important; background: transparent !important; }
                </style>
            </head>
            <body>
                <div class="rm-container">
                    ${printArea.innerHTML}
                </div>
            </body>
            </html>
        `);
        
        printWindow.document.close();
        // ì´ë¯¸ì§€ ë¡œë”© ë“±ì„ ìœ„í•´ ì ì‹œ ëŒ€ê¸° í›„ ì¸ì‡„
        setTimeout(() => {
            printWindow.focus();
            printWindow.print();
        }, 500);
    }
    
    // ... [ë¡œë“œë§µ ê´€ë ¨ ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤: openRoadmapPopup, closeRoadmapPopup ë“± ê¸°ì¡´ ìœ ì§€] ...

    function openRoadmapPopup() {
        document.getElementById('roadmap-modal').style.display = 'flex';
        resetRoadmapInput();
        const comp = document.getElementById('input-company').value.trim();
        document.getElementById('print-company-name').innerText = comp ? comp + " Project Schedule" : "Project Schedule"; 
        const mem = document.getElementById('display-member').innerText || "ë‹´ë‹¹ì";
        document.getElementById('print-member-name').innerText = `ì˜¤ë„ˆìŠ¤ê²½ì˜ì—°êµ¬ì†Œ - ${mem} íŒ€ì¥`;
        renderRoadmapView(); 
    }

    function closeRoadmapPopup() { 
        document.getElementById('roadmap-modal').style.display = 'none'; 
    }
    
    function saveRoadmap() {
        showToast('ë¡œë“œë§µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        closeRoadmapPopup();
    }

    function initRoadmapInputs() {
        const startSel = document.getElementById('rm-start'); 
        const endSel = document.getElementById('rm-end');
        const presetDiv = document.getElementById('rm-presets'); 
        presetDiv.innerHTML = '';
        roadmapItems.forEach(item => { 
            presetDiv.innerHTML += `<button class="btn-preset" onclick="setPresetName('${item}')">${item}</button>`; 
        });
        startSel.innerHTML = ''; endSel.innerHTML = '';
        const baseYear = new Date().getFullYear(); 
        for(let y=0; y<5; y++) { 
            for(let m=1; m<=12; m++) { 
                const val = (y*12) + m; 
                const label = `${baseYear+y}ë…„ ${m}ì›”`; 
                startSel.innerHTML += `<option value="${val}">${label}</option>`; 
                endSel.innerHTML += `<option value="${val}">${label}</option>`; 
            } 
        }
    }

    function setPresetName(name) {
        const input = document.getElementById('rm-name'); 
        input.value = name; 
        input.focus();
        document.querySelectorAll('.btn-preset').forEach(btn => btn.classList.remove('active')); 
        event.target.classList.add('active');
    }

    function resetRoadmapInput() {
        initRoadmapInputs();
        document.getElementById('rm-name').value = ''; 
        document.getElementById('rm-start').value = 1; 
        document.getElementById('rm-end').value = 1; 
        document.getElementById('rm-desc').value = ''; 
        document.getElementById('rm-align').value = 'center';
        editIndex = -1; 
        document.getElementById('btn-add-rm').innerHTML = '<i class="fa-solid fa-plus"></i> ì¶”ê°€'; 
        document.getElementById('btn-add-rm').classList.replace('btn-dark','btn-primary'); 
        document.getElementById('btn-cancel-rm').style.display = 'none'; 
        document.getElementById('rm-input-box').classList.remove('edit-mode'); 
        renderRoadmapView();
    }

    function addManualRoadmap() {
        const name = document.getElementById('rm-name').value; 
        const start = parseInt(document.getElementById('rm-start').value); 
        const end = parseInt(document.getElementById('rm-end').value); 
        const desc = document.getElementById('rm-desc').value; 
        const align = document.getElementById('rm-align').value; 
        if(!name) return showToast("í•­ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”", 'error'); 
        if(end < start) return showToast("ì¢…ë£Œ ì‹œì  ì˜¤ë¥˜", 'error');
        const duration = end - start + 1; 
        const newItem = { name: name, start: start, duration: duration, desc: desc, align: align };
        if(editIndex > -1) tempRoadmap[editIndex] = newItem; 
        else tempRoadmap.push(newItem);
        resetRoadmapInput(); 
    }

    function loadRoadmapItemForEdit(idx) {
        if(isDragging) return;
        if(!confirm("ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const item = tempRoadmap[idx];
        document.getElementById('rm-name').value = item.name; 
        document.getElementById('rm-start').value = item.start; 
        document.getElementById('rm-end').value = item.start + item.duration - 1; 
        document.getElementById('rm-desc').value = item.desc || ''; 
        document.getElementById('rm-align').value = item.align || 'center'; 
        editIndex = idx; 
        document.getElementById('btn-add-rm').innerHTML = '<i class="fa-solid fa-check"></i> ìˆ˜ì • ì €ì¥'; 
        document.getElementById('btn-add-rm').classList.replace('btn-primary','btn-dark'); 
        document.getElementById('btn-cancel-rm').style.display = 'block'; 
        document.getElementById('rm-input-box').classList.add('edit-mode'); 
        document.getElementById('rm-name').focus();
    }

    function removeRoadmapItem(idx) { 
        if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { 
            tempRoadmap.splice(idx, 1); 
            if(editIndex===idx) resetRoadmapInput(); 
            else if(editIndex>idx) editIndex--; 
            renderRoadmapView(); 
        } 
    }

    function handleDragStart(e, idx) { 
        isDragging = true; 
        dragSrcIndex = idx; 
        dragSrcEl = e.target; 
        e.target.classList.add('dragging'); 
        e.dataTransfer.effectAllowed = 'move'; 
    }

    function handleDragOver(e) { 
        if(e.preventDefault) e.preventDefault(); 
        e.dataTransfer.dropEffect = 'move'; 
        const t=e.target.closest('.rm-item-chip'); 
        if(t&&t!==dragSrcEl) { 
            document.querySelectorAll('.rm-item-chip').forEach(el=>el.classList.remove('drag-over')); 
            t.classList.add('drag-over'); 
        } 
        return false; 
    }

    function handleDragLeave(e) { 
        const t=e.target.closest('.rm-item-chip'); 
        if(t) t.classList.remove('drag-over'); 
    }

    function handleDrop(e, dropIndex) { 
        if(e.stopPropagation) e.stopPropagation(); 
        if(dragSrcIndex!==dropIndex) { 
            const item=tempRoadmap[dragSrcIndex]; 
            tempRoadmap.splice(dragSrcIndex,1); 
            tempRoadmap.splice(dropIndex,0,item); 
            resetRoadmapInput(); 
            renderRoadmapView(); 
        } 
        return false; 
    }

    function handleDragEnd(e) { 
        document.querySelectorAll('.rm-item-chip').forEach(el=>{
            el.classList.remove('dragging'); 
            el.classList.remove('drag-over');
        }); 
        setTimeout(() => { isDragging = false; }, 100); 
    }

    function renderRoadmapView() {
        const tbody = document.getElementById('rm-body'); 
        const listDiv = document.getElementById('rm-list'); 
        const h1 = document.getElementById('rm-header-row-1'); 
        const h2 = document.getElementById('rm-header-row-2');
        tbody.innerHTML=''; 
        listDiv.innerHTML='';
        
        let maxMonth=12; 
        tempRoadmap.forEach(i=>{ 
            if(i.start+i.duration-1>maxMonth) maxMonth=i.start+i.duration-1; 
        });
        
        const years=Math.ceil(maxMonth/12); 
        const baseYear=2026;
        let hh1=`<th class="rm-header rm-diagonal" style="width:120px;" rowspan="2"><span class="rm-diagonal-text rm-text-bottom-left">í•­ëª©</span><span class="rm-diagonal-text rm-text-top-right">ì¼ì •</span></th>`;
        let hh2=''; 
        
        for(let y=0; y<years; y++) { 
            hh1+=`<th class="rm-header" colspan="12">${baseYear+y}</th>`; 
            for(let m=1; m<=12; m++) hh2+=`<th class="rm-subheader">${m}</th>`; 
        }
        h1.innerHTML=hh1; 
        h2.innerHTML=hh2;
        
        if(tempRoadmap.length===0) {
            listDiv.innerHTML='<div style="text-align:center;color:#94a3b8;font-size:12px;">í•­ëª© ì—†ìŒ</div>';
        } else {
            tempRoadmap.forEach((item,idx)=>{
                const chip=document.createElement('div'); 
                chip.className='rm-item-chip'; 
                chip.draggable=true;
                chip.innerHTML=`<i class="fa-solid fa-grip-vertical" style="color:#94a3b8;margin-right:5px;"></i><span style="font-weight:bold;color:#334155;">${item.name}</span><i class="fa-solid fa-xmark" style="color:#ef4444;margin-left:8px;cursor:pointer;"></i>`;
                chip.addEventListener('dragstart',e=>handleDragStart(e,idx)); 
                chip.addEventListener('dragover',handleDragOver); 
                chip.addEventListener('dragleave',handleDragLeave); 
                chip.addEventListener('drop',e=>handleDrop(e,idx)); 
                chip.addEventListener('dragend',handleDragEnd);
                chip.onclick=()=>loadRoadmapItemForEdit(idx); 
                chip.querySelector('.fa-xmark').onclick=e=>{
                    e.stopPropagation(); 
                    removeRoadmapItem(idx);
                };
                listDiv.appendChild(chip);
            });
        }
        
        if(tempRoadmap.length===0) { 
            tbody.innerHTML=`<tr><td colspan="${1+(years*12)}" style="text-align:center;padding:20px;color:#cbd5e1;">ë¹„ì–´ìˆìŒ</td></tr>`; 
            return; 
        }
        
        tempRoadmap.forEach((item,idx)=>{
            let tr='<tr>'; 
            const cHex=colorPalette[Math.min(idx,5)]; 
            const tCol=(Math.min(idx,5)>=4)?'#1e293b':'white';
            tr+=`<td class="rm-cat-col" onclick="loadRoadmapItemForEdit(${idx})" style="background:${cHex};border-color:${cHex};color:${tCol};cursor:pointer;">${item.name}</td>`;
            const cols=years*12;
            for(let i=1; i<=cols; i++) {
                if(i===item.start) {
                    const desc=item.desc?item.desc.replace(/\/\//g,'<br>'):''; 
                    const align=item.align||'center';
                    let cont=''; 
                    if(align==='out') {
                        cont=`<div class="rm-bar-container" style="width:100%;background:${cHex};"></div><div class="rm-bar-outer-text">${desc}</div>`;
                    } else {
                        cont=`<div class="rm-bar-container rm-align-${align}" style="width:100%;background:${cHex};color:${tCol};"><span class="rm-bar-desc">${desc}</span></div>`;
                    }
                    tr+=`<td class="rm-cell" colspan="${item.duration}" style="border-right:none;z-index:1;overflow:visible;" onclick="loadRoadmapItemForEdit(${idx})">${cont}</td>`;
                    i+=(item.duration-1);
                } else {
                    tr+='<td class="rm-cell"></td>';
                }
            }
            tr+='</tr>'; 
            tbody.innerHTML+=tr;
        });
    }

</script>
</body>
</html>
