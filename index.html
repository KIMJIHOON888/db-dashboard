<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DB Pro Master v24.6 (Date Fix)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* [1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ë””ìì¸ í”„ë ˆì„ì›Œí¬ - PC ë²„ì „ ìœ ì§€] */
        :root { --primary: #2563eb; --bg-light: #f8fafc; --border: #e2e8f0; --prospect: #8b5cf6; }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: var(--bg-light); color: #334155; height: 100vh; display: flex; overflow: hidden; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .btn { padding: 10px 16px; border-radius: 6px; border: none; font-weight: 700; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: #fee2e2; color: #ef4444; }
        .btn-dark { background: #1e293b; color: white; } 
        .btn-secondary { background: #64748b; color: white; }
        
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="date"] { cursor: pointer; position: relative; }
        input[type="date"]::-webkit-calendar-picker-indicator { position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        /* [ë¡œê·¸ì¸ í™”ë©´] */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 20px; width: 400px; text-align: center; box-shadow: 0 20px 25px rgba(0,0,0,0.2); }
        .login-input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; margin-bottom: 15px; font-size: 16px; transition: border-color 0.2s; }
        .login-input:focus { border-color: var(--primary); }

        /* [ë¡œë”© ìŠ¤í”¼ë„ˆ] */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: none; justify-content: center; align-items: center; flex-direction: column; color: white; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* [ì‚¬ì´ë“œë°” & ë©”ì¸] */
        .sidebar { width: 270px; background: white; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; transition: all 0.3s; position: relative; z-index: 50; }
        .sidebar.admin-mode { background: linear-gradient(160deg, #0f172a 0%, #1e293b 100%) !important; color: white !important; border-right: none; box-shadow: 4px 0 15px rgba(0,0,0,0.1); }
        .sidebar.admin-mode .logo-area { color: white !important; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .sidebar.admin-mode .nav-item { color: #94a3b8 !important; }
        .sidebar.admin-mode .nav-item:hover, .sidebar.admin-mode .nav-item.active { background: rgba(255,255,255,0.1) !important; color: #fff !important; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .sidebar.admin-mode .btn-big-action { background: #3b82f6; color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }

        .logo-area { font-size: 22px; font-weight: 900; color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px; }
        .btn-big-action { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 15px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 10px; }
        .btn-new-db { background: var(--primary); color: white; }
        .btn-new-member { background: #10b981; color: white; display: none; } 
        .btn-del-member { background: #ef4444; color: white; display: none; }

        .nav-item { padding: 14px; margin-bottom: 8px; border-radius: 10px; cursor: pointer; color: #64748b; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: #eff6ff; color: var(--primary); }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; z-index: 1; }
        .header { height: 60px; background: white; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .page-content { flex: 1; overflow-y: auto; padding: 30px; }

        .card { background: white; border-radius: 16px; padding: 25px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .table-container { overflow-x: auto; background: white; border-radius: 12px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; }
        th { background: #f8fafc; padding: 14px; text-align: center; color: #64748b; font-weight: 700; border-bottom: 1px solid var(--border); }
        td { padding: 14px; border-bottom: 1px solid var(--border); color: #333; text-align: center; }
        tr:hover { background-color: #f8fafc; cursor: pointer; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; }
        .status-wait { background: #f1f5f9; color: #64748b; }
        .status-ing { background: #dbeafe; color: #2563eb; }
        .status-prospect { background: #f3e8ff; color: #7c3aed; }
        .status-done { background: #dcfce7; color: #16a34a; }
        .status-end { background: #fee2e2; color: #dc2626; }
        .status-share { background: #ffedd5; color: #c2410c; }
        
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; justify-content: space-between; border-left: 5px solid var(--primary); }
        .stat-label { font-size: 14px; color: #64748b; font-weight: 700; margin-bottom: 10px; }
        .stat-value { font-size: 22px; font-weight: 900; color: #1e293b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .rank-card { flex:1; background:white; border-radius:12px; padding:20px; border:1px solid #e2e8f0; }
        .rank-title { font-weight:800; font-size:16px; margin-bottom:15px; display:flex; align-items:center; gap:8px; }
        .rank-list { list-style:none; padding:0; margin:0; }
        .rank-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #f1f5f9; font-size:14px; }
        .rank-item:last-child { border-bottom:none; }
        .rank-val { font-weight:bold; color:var(--primary); }
        .sub-kpi { font-size: 10px; color: #64748b; margin-top: 4px; line-height: 1.2; }

        .compare-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .compare-box { flex: 1; background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0; }
        .compare-val { font-size: 24px; font-weight: 800; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-window { background: white; width: 1200px; height: 95vh; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        
        #roadmap-modal .modal-window { width: 1400px; height: 95vh; border-radius: 15px; }
        #roadmap-modal .modal-body { flex-direction: column; padding: 30px; overflow-y: auto; background: white; }

        .modal-header { padding: 20px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { flex: 1; display: flex; overflow: hidden; background: #f8fafc; }
        .panel-left { flex: 7; padding: 30px; overflow-y: auto; border-right: 1px solid var(--border); }
        .panel-right { flex: 3; padding: 30px; display: flex; flex-direction: column; background: white; }
        
        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .form-group label { display: block; font-size: 12px; font-weight: 700; color: #64748b; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; }
        .dynamic-section { display: none; background: white; border: 1px solid var(--border); padding: 20px; border-radius: 8px; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .dynamic-section.active { display: block; animation: fadeIn 0.3s; }
        .contract-box { background: #ecfdf5; border-color: #6ee7b7; }
        .prospect-box { background: #f3e8ff; border-color: #d8b4fe; }
        .share-info { background: #fffbeb; border: 1px solid #fcd34d; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 13px; }
        
        .share-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .share-row select { width: 120px; padding: 6px; border-radius: 4px; border: 1px solid #ddd; }
        .share-row input { width: 70px; padding: 6px; text-align: right; border-radius: 4px; border: 1px solid #ddd; }
        .share-val { font-weight: bold; color: var(--primary); margin-left: 5px; width: 100px; text-align: right; }
        
        .roadmap-toolbar { background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .roadmap-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
        .btn-preset { padding: 10px 14px; font-size: 14px; background: white; color: #475569; border: 1px solid #cbd5e1; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 2px 3px rgba(0,0,0,0.03); transition: 0.2s; }
        .btn-preset:hover, .btn-preset.active { background: #eff6ff; color: var(--primary); border-color: var(--primary); transform: translateY(-1px); }
        
        .rm-input-row { display: flex; gap: 10px; align-items: center; background: white; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: 0.3s; }
        .rm-input-row.edit-mode { border: 2px solid var(--primary); background: #eff6ff; }
        .rm-input-group { display: flex; flex-direction: column; gap: 5px; }
        .rm-input-label { font-size: 12px; color: #64748b; font-weight: bold; }
        
        .rm-container { border: 2px solid #334155; padding: 30px; border-radius: 15px; margin-bottom: 20px; background: white; position: relative; overflow-x: auto; }
        
        .rm-title-edit { text-align:center; color:#1e293b; margin-bottom:40px; font-family:'Pretendard', sans-serif; font-size: 32px; font-weight: 900; border: 2px dashed transparent; border-radius: 8px; padding: 10px; transition: 0.2s; cursor: text; outline:none; }
        .rm-title-edit:hover, .rm-title-edit:focus { border-color: #cbd5e1; background: #f8fafc; }
        .rm-title-edit.placeholder { color: #cbd5e1; }
        
        .rm-table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 12px; }
        .rm-header { background: #1e3a8a; color: white; text-align: center; font-weight: bold; padding: 12px 0; border: 1px solid #94a3b8; }
        .rm-subheader { background: #3b82f6; color: white; text-align: center; font-size: 11px; padding: 6px 0; border: 1px solid #94a3b8; }
        .rm-cell { border: 1px solid #cbd5e1; height: 55px; position: relative; padding: 0; background: white; }
        
        .rm-cat-col { width: 120px; text-align: center; font-weight: 800; vertical-align: middle; border: 1px solid #94a3b8; color: white; font-size: 12.5px; padding: 5px; word-break: keep-all; white-space: normal; line-height: 1.3; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .rm-diagonal { background: linear-gradient(to top right, #f1f5f9 49.5%, #94a3b8 50%, #f1f5f9 50.5%); position: relative; padding: 0; border: 1px solid #94a3b8; }
        .rm-diagonal-text { position: absolute; font-size: 11px; font-weight: bold; color: #334155; }
        .rm-text-bottom-left { bottom: 5px; left: 8px; }
        .rm-text-top-right { top: 5px; right: 8px; }

        .rm-bar-container { position: absolute; top: 10px; bottom: 10px; border-radius: 15px; display: flex; align-items: center; color: white; font-size: 12px; font-weight: bold; box-shadow: 2px 3px 6px rgba(0,0,0,0.15); white-space: normal; overflow: hidden; z-index: 10; opacity: 0; animation: slideIn 0.5s forwards; line-height:1.2; cursor: pointer; transition: transform 0.2s, filter 0.2s; }
        .rm-bar-container:hover { transform: scale(1.02); filter: brightness(1.1); z-index: 15; }
        
        .rm-align-left { justify-content: flex-start; padding-left: 10px; text-align: left; }
        .rm-align-center { justify-content: center; text-align: center; padding: 0 5px; }
        .rm-align-right { justify-content: flex-end; padding-right: 10px; text-align: right; }
        
        .rm-bar-text { text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .rm-bar-outer-text { position: absolute; top: 50%; transform: translateY(-50%); left: 105%; width: 200px; font-size: 11px; font-weight: bold; color: #334155; z-index: 5; line-height:1.3; text-align:left; display: flex; flex-direction: column; justify-content: center; cursor: pointer; }
        .rm-bar-outer-text:hover { color: var(--primary); text-decoration: underline; }

        .bg-grad-0 { background: #0f172a; } 
        .bg-grad-1 { background: #1e3a8a; } 
        .bg-grad-2 { background: #1d4ed8; } 
        .bg-grad-3 { background: #3b82f6; } 
        .bg-grad-4 { background: #60a5fa; } 
        .bg-grad-5 { background: #93c5fd; color:#1e293b !important; text-shadow:none !important; } 

        .rm-item-chip { display:inline-block; background:#f1f5f9; padding:6px 10px; margin:3px; border-radius:6px; border:1px solid #cbd5e1; font-size:12px; cursor:grab; align-items:center; transition:0.2s; }
        .rm-item-chip:hover { background: #e2e8f0; transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .rm-item-chip.dragging { opacity: 0.5; background: #cbd5e1; border: 1px dashed #64748b; }
        .rm-item-chip.drag-over { border-left: 3px solid var(--primary); background: #eff6ff; }

        @keyframes slideIn { from { width: 0; opacity: 0; } to { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar-bg { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; width: 100px; margin: 0 auto; }
        .progress-bar-fill { height: 100%; background: var(--primary); border-radius: 4px; }
        
        #input-consulting { resize: both; overflow: auto; min-height: 100px; }

        /* ==========================================================================
           [â˜… 15ë…„ ì°¨ ì „ë¬¸ê°€ì˜ ëª¨ë°”ì¼ ë°˜ì‘í˜• íŒ¨ì¹˜ (Magic Responsive Code)]
           - PCì—ì„œëŠ” ì´ ì½”ë“œê°€ ë¬´ì‹œë˜ë©°, í­ 768px ì´í•˜ ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤.
           ========================================================================== */
        @media (max-width: 768px) {
            /* [ì „ì²´ êµ¬ì¡° ë³€ê²½: ê°€ë¡œ ë°°ì¹˜ -> ì„¸ë¡œ ë°°ì¹˜] */
            body { flex-direction: column; overflow: auto; }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; z-index: 9999; transform: translateX(-100%); width: 280px; box-shadow: none; transition: transform 0.3s ease; }
            .sidebar.active { transform: translateX(0); box-shadow: 100px 0 0 rgba(0,0,0,0.5); } /* ê·¸ë¦¼ì íš¨ê³¼ë¡œ ë’·ë°°ê²½ ì–´ë‘¡ê²Œ */
            
            .main-content { width: 100%; height: auto; overflow: visible; }
            .page-content { padding: 15px; overflow: visible; height: auto; padding-bottom: 80px; } /* í•˜ë‹¨ ì—¬ë°± í™•ë³´ */
            
            /* [í—¤ë”: í–„ë²„ê±° ë²„íŠ¼ ì¶”ê°€] */
            .header { padding: 0 15px; justify-content: flex-start; gap: 15px; height: 50px; }
            #mobile-menu-btn { display: block !important; font-size: 24px; cursor: pointer; color: #334155; }
            #page-title { font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

            /* [ë¡œê·¸ì¸ í™”ë©´ ìµœì í™”] */
            .login-box { width: 90%; padding: 25px; }

            /* [ëŒ€ì‹œë³´ë“œ & ê·¸ë¦¬ë“œ: 1ë‹¨ ë°°ì—´ë¡œ ë³€ê²½] */
            .dashboard-grid { grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
            .form-grid { grid-template-columns: 1fr; gap: 10px; }
            .compare-row { flex-direction: column; gap: 10px; }
            
            /* [ë­í‚¹ ì¹´ë“œ ì„¸ë¡œ ë°°ì¹˜] */
            div[style*="display:flex; gap:20px;"] { flex-direction: column; gap: 10px; }
            
            /* [ë¦¬ìŠ¤íŠ¸ í•„í„°: ì„¸ë¡œ ë°°ì¹˜] */
            #list-filter-container { flex-direction: column; align-items: stretch; }
            #list-filter-container select, #list-filter-container input { width: 100%; margin-bottom: 5px; }

            /* [ëª¨ë‹¬ íŒì—…: ì „ì²´ í™”ë©´ ê½‰ ì°¨ê²Œ] */
            .modal-window { width: 100% !important; height: 100% !important; border-radius: 0; top: 0; left: 0; }
            .modal-body { flex-direction: column; padding: 15px; overflow-y: auto; }
            .panel-left, .panel-right { padding: 0; border: none; overflow: visible; flex: none; }
            .panel-right { border-top: 4px solid #f1f5f9; padding-top: 20px; margin-top: 20px; padding-bottom: 30px; }
            .modal-header { padding: 15px; }
            
            /* [í…Œì´ë¸”: ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš©] */
            .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            th, td { padding: 10px 5px; font-size: 12px; }
            
            /* [ë¡œë“œë§µ íŒì—…] */
            #roadmap-modal .modal-window { width: 100% !important; height: 100% !important; border-radius: 0; }
            .rm-input-row { flex-direction: column; align-items: stretch; gap: 10px; }
            .rm-input-group { width: 100%; }
        }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div style="font-weight:bold; font-size:18px;">ì„œë²„ì™€ í†µì‹  ì¤‘...</div>
</div>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color:var(--primary); margin-bottom:30px;"><i class="fa-solid fa-server"></i> DB Pro v24.6</h2>
        <input type="text" id="login-user-name" class="login-input" placeholder="ì„±í•¨ ì…ë ¥ (ì˜ˆ: í™ê¸¸ë™)" onkeypress="if(event.keyCode==13) document.getElementById('login-pw').focus()">
        <input type="password" id="login-pw" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ (ì´ˆê¸°: 1234)" onkeypress="if(event.keyCode==13) attemptLogin('member')">
        
        <div style="text-align: left; margin-bottom: 15px; padding-left: 5px;">
            <label style="font-size: 14px; color: #64748b; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="login-remember" style="width: 16px; height: 16px; cursor: pointer;"> ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
            </label>
        </div>

        <div style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn btn-primary" style="padding:15px; font-size:16px;" onclick="attemptLogin('member')">íŒ€ì› ì ‘ì†í•˜ê¸°</button>
            <button class="btn btn-dark" style="padding:15px; font-size:16px;" onclick="attemptLogin('admin')">ê´€ë¦¬ì ì ‘ì†í•˜ê¸°</button>
        </div>
        <p style="margin-top:20px; font-size:12px; color:#94a3b8;">* ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: <b>1234</b> (ê´€ë¦¬ì ì ‘ì† ì‹œ ë¹„ë°€ë²ˆí˜¸ë§Œ ì…ë ¥)</p>
    </div>
</div>

<div class="sidebar" id="app-sidebar" style="display:none;">
    <div class="logo-area"><i class="fa-solid fa-layer-group"></i> DB Master</div>
    <button class="btn-big-action btn-new-db" onclick="openModal(); toggleMobileMenu();">+ ì‹ ê·œ DB ë“±ë¡</button>
    <button class="btn-big-action btn-new-member" id="btn-add-member" onclick="addTeamMember()">+ ì‹ ê·œ íŒ€ì› ì¶”ê°€</button>
    <button class="btn-big-action btn-del-member" id="btn-del-member" onclick="deleteTeamMember()">- íŒ€ì› ì‚­ì œ</button>

    <div style="background:#f1f5f9; padding:15px; border-radius:12px; margin: 15px 0; color:#333;">
        <div id="profile-name" style="font-weight:bold; font-size:16px;"></div>
        <div style="font-size:12px; opacity:0.7; margin-top:4px;" id="profile-role"></div>
        <button onclick="changePassword()" style="margin-top:10px; font-size:11px; padding:4px 8px; border:1px solid #ddd; background:white; border-radius:4px; cursor:pointer; color:#333; z-index:100; position:relative;">ë¹„ë²ˆë³€ê²½</button>
    </div>

    <div id="nav-list" class="nav-item active" onclick="navTo('list'); toggleMobileMenu();"><i class="fa-solid fa-folder-open"></i> <span id="menu-list-text">ë‚˜ì˜ DB ê´€ë¦¬</span></div>
    <div id="nav-analysis" class="nav-item" onclick="navTo('analysis'); toggleMobileMenu();"><i class="fa-solid fa-chart-column"></i> ì‹¤ì  ìƒì„¸ ë¶„ì„</div>
    <div id="nav-history" class="nav-item" onclick="navTo('history'); toggleMobileMenu();"><i class="fa-solid fa-calendar-days"></i> <span id="menu-hist-text">ì›”ë³„ íˆìŠ¤í† ë¦¬</span></div>
    
    <div id="admin-menu" style="display:none; margin-top:20px;">
        <div style="font-size:11px; opacity:0.7; font-weight:bold; padding-left:10px; margin-bottom:5px;">ê´€ë¦¬ì ì „ìš©</div>
        <div id="nav-dashboard" class="nav-item" onclick="navTo('dashboard'); toggleMobileMenu();"><i class="fa-solid fa-tower-observation"></i> í†µí•© ê´€ì œíƒ‘</div>
    </div>
    <button onclick="logout()" style="margin-top:auto; background:none; border:none; color:#ef4444; font-weight:bold; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div id="mobile-sidebar-overlay" onclick="toggleMobileMenu()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:40;"></div>

<div class="main-content" id="app-main" style="display:none;">
    <div class="header">
        <i class="fa-solid fa-bars" id="mobile-menu-btn" style="display:none;" onclick="toggleMobileMenu()"></i>
        <h2 id="page-title" style="font-size:20px; font-weight:800;">ë‚˜ì˜ DB ê´€ë¦¬</h2>
        <div style="font-size:12px; color:#64748b; font-weight:bold;"><i class="fa-solid fa-cloud"></i> Server Mode v24.2</div>
    </div>

    <div class="page-content" id="view-list">
        <div class="card" style="padding:15px;">
            <div id="list-filter-container" style="display:flex; gap:10px; margin-bottom:10px;"></div>
            <div style="font-size:13px; color:#64748b; background:#f8fafc; padding:10px; border-radius:6px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:8px;">
                <i class="fa-solid fa-info-circle" style="color:var(--primary);"></i> 
                ì‰ì–´ ë°›ì€ DBëŠ” ì¶œì²˜ì— <b>[ì´ë¦„]ì‰ì–´</b>ë¡œ í‘œì‹œë˜ë©° ìë™ìœ¼ë¡œ ëª©ë¡ì— ë™ê¸°í™”ë©ë‹ˆë‹¤.
            </div>
        </div>
        <div class="table-container" style="height: calc(100vh - 280px); overflow-y: auto;">
            <table>
                <thead id="list-head"></thead>
                <tbody id="list-body"></tbody>
            </table>
        </div>
    </div>

    <div class="page-content" id="view-analysis" style="display:none;">
        <div id="admin-analysis-filter" style="display:none; margin-bottom:20px; background:white; padding:15px; border-radius:12px; border:1px solid #ddd;">
            <span style="font-weight:bold; color:var(--primary);">ğŸ¯ ë¶„ì„ ëŒ€ìƒ :</span>
            <select id="analysis-target" onchange="renderAnalysisData()" style="padding:8px; border-radius:6px; font-weight:bold;"><option value="all">ğŸ¢ íšŒì‚¬ ì „ì²´</option></select>
        </div>
        <div id="admin-yoy-summary" style="display:none; margin-bottom:30px;">
            <div class="section-title">ğŸ‘¥ íŒ€ì›ë³„ ì‹¤ì  ìš”ì•½</div>
            <div class="table-container">
                <table id="yoy-summary-table">
                    <thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì‘ë…„ ë§¤ì¶œ</th><th>ì˜¬í•´ ë§¤ì¶œ</th><th>ì„±ì¥ì•¡</th><th>ë‹¬ì„±ë¥ </th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="section-title">ğŸ“Š ì „ë…„ vs ê¸ˆë…„ ì‹¤ì  ë¹„êµ</div>
        <div class="compare-row">
            <div class="compare-box"><div class="compare-val" style="color:#64748b;" id="val-last-total">0</div><div style="font-size:12px; color:#94a3b8;">ì‘ë…„ ì´ ë§¤ì¶œ</div></div>
            <div class="compare-box" style="background:#eff6ff;"><div class="compare-val" style="color:var(--primary);" id="val-this-total">0</div><div style="font-size:12px; color:var(--primary);">ì˜¬í•´ ì´ ë§¤ì¶œ</div></div>
            <div class="compare-box"><div class="compare-val" id="val-growth">0</div><div style="font-size:12px; color:#64748b;">ì „ë…„ ëŒ€ë¹„ ì„±ì¥</div></div>
        </div>
        <div class="card">
            <h4>ğŸ“… ì›”ë³„ ë§¤ì¶œ ì¶”ì´ (YoY)</h4>
            <div class="table-container">
                <table id="yoy-detail-table">
                    <thead><tr><th>êµ¬ë¶„</th><th>1ì›”</th><th>2ì›”</th><th>3ì›”</th><th>4ì›”</th><th>5ì›”</th><th>6ì›”</th><th>7ì›”</th><th>8ì›”</th><th>9ì›”</th><th>10ì›”</th><th>11ì›”</th><th>12ì›”</th><th>í•©ê³„</th></tr></thead>
                    <tbody id="yoy-detail-body"></tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h4>ğŸ“‹ ì›”ë³„ DB ì¶œì²˜ë³„ ì„±ê³¼ (ê±´ìˆ˜ / ê¸ˆì•¡)</h4>
            <div class="table-container">
                <table id="month-kpi-table">
                    <thead><tr><th>êµ¬ë¶„</th><th>1ì›”</th><th>2ì›”</th><th>3ì›”</th><th>4ì›”</th><th>5ì›”</th><th>6ì›”</th><th>7ì›”</th><th>8ì›”</th><th>9ì›”</th><th>10ì›”</th><th>11ì›”</th><th>12ì›”</th><th>í•©ê³„</th></tr></thead>
                    <tbody id="month-kpi-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="page-content" id="view-history" style="display:none;">
        <div class="card" style="display:flex; align-items:center; gap:15px; background:#f1f5f9;">
            <h3 style="margin:0; font-size:16px;">ğŸ“… ì¡°íšŒ ê¸°ê°„ :</h3>
            <select id="hist-year" style="padding:8px; border-radius:6px;"></select>
            <select id="hist-month" style="padding:8px; border-radius:6px;"></select>
            <button class="btn btn-primary" onclick="renderHistory()">ì¡°íšŒí•˜ê¸°</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;" id="history-tabs"></div>
        <div class="table-container">
            <table><thead id="history-head"></thead><tbody id="history-body"></tbody></table>
        </div>
    </div>

    <div class="page-content" id="view-dashboard" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;"><i class="fa-solid fa-tower-observation"></i> í†µí•© ê´€ì œíƒ‘ (Control Tower)</h3>
            <select id="admin-stat-month" style="padding:5px; border-radius:4px;" onchange="renderAdminDashboard()"></select>
        </div>
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-label">ì´ë²ˆë‹¬ ì´ ë§¤ì¶œ (ì „ì‚¬)</div>
                <div class="stat-value" id="ad-total-rev">0</div>
            </div>
            <div class="stat-card" style="border-left-color:#10b981;">
                <div class="stat-label">ì´ë²ˆë‹¬ ì´ ê³„ì•½</div>
                <div class="stat-value" id="ad-total-cont">0ê±´</div>
            </div>
            <div class="stat-card" style="border-left-color:#f59e0b;">
                <div class="stat-label">ì´ë²ˆë‹¬ ì‹ ê·œ DB ìœ ì…</div>
                <div class="stat-value" id="ad-total-db">0ê°œ</div>
            </div>
            <div class="stat-card" style="border-left-color:#8b5cf6;">
                <div class="stat-label">ì „ì²´ ê³„ì•½ ì „í™˜ìœ¨</div>
                <div class="stat-value" id="ad-conv-rate">0%</div>
            </div>
        </div>
        <h3 style="margin-bottom:15px;">ğŸ† ì´ë‹¬ì˜ ëª…ì˜ˆì˜ ì „ë‹¹ (ì‹¤ì  ë‹¬ì„±)</h3>
        <div style="display:flex; gap:20px; margin-bottom:30px;">
            <div class="rank-card" style="border-top:4px solid #f59e0b;">
                <div class="rank-title" style="color:#b45309;"><i class="fa-solid fa-trophy"></i> 500ë§Œì› ì´ìƒ</div>
                <ul class="rank-list" id="rank-500"></ul>
            </div>
            <div class="rank-card" style="border-top:4px solid #10b981;">
                <div class="rank-title" style="color:#047857;"><i class="fa-solid fa-medal"></i> 300ë§Œì› ì´ìƒ</div>
                <ul class="rank-list" id="rank-300"></ul>
            </div>
            <div class="rank-card" style="border-top:4px solid #3b82f6;">
                <div class="rank-title" style="color:#1d4ed8;"><i class="fa-solid fa-thumbs-up"></i> 60ë§Œì› ì´ìƒ</div>
                <ul class="rank-list" id="rank-60"></ul>
            </div>
        </div>
        <h4 style="margin-bottom:15px;">ğŸ‘¥ íŒ€ì›ë³„ ì¢…í•© ì„±ê³¼ í˜„í™©í‘œ</h4>
        <div class="card">
            <div class="table-container">
                <table>
                    <thead><tr><th>ìˆœìœ„</th><th>íŒ€ì›ëª…</th><th>DBë°°ì •</th><th>ë¯¸íŒ…ì§„í–‰</th><th>ê°€ë§ê³ ê°</th><th>ê³„ì•½ê±´ìˆ˜</th><th>ì „í™˜ìœ¨</th><th>ì´ ë§¤ì¶œì•¡</th><th>ìƒíƒœ</th></tr></thead>
                    <tbody id="team-status-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modal">
    <div class="modal-window">
        <div class="modal-header">
            <h3>ğŸ“ DB ì •ë³´ ìƒì„¸</h3>
            <button onclick="closeModal()" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div class="modal-body">
            <div class="panel-left">
                <input type="hidden" id="edit-id">
                
                <div class="card" style="margin:0 0 20px 0; border-left:4px solid var(--primary);">
                    <div class="section-label" style="color:var(--primary);">1ë‹¨ê³„: ì—…ì²´ ê¸°ë³¸ì •ë³´</div>
                    <div style="background:#f8fafc; padding:12px; margin-bottom:15px; border-radius:6px; font-size:14px; border:1px solid #e2e8f0;">
                        <b>ë‹´ë‹¹ì:</b> <span id="display-member" style="color:var(--primary); font-weight:bold;"></span> (ê³ ì •ê°’)
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>ì ‘ìˆ˜ì¼</label><input type="date" id="input-date" onclick="this.showPicker()"></div>
                        <div class="form-group">
                            <label>DB ì¶œì²˜</label>
                            <select id="input-source" onchange="updateShareFields(); toggleGradeField(); calculateShare();">
                                <option value="íšŒì‚¬DB">ğŸ¢ íšŒì‚¬ DB</option>
                                <option value="ê°œì¸DB">ğŸ‘¤ ê°œì¸ DB</option>
                                <option value="íŒ€DB">ğŸ‘¥ íŒ€ DB</option>
                                <option value="ê¸°íƒ€DB">ğŸ¸ ê¸°íƒ€ DB</option>
                            </select>
                        </div>
                        <div class="form-group" id="group-grade-prov">
                            <label>ì œê³µ ë“±ê¸‰ (íšŒì‚¬DB ì „ìš©)</label>
                            <select id="input-grade-prov"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select>
                        </div>
                        <div class="form-group"><label>ì—…ì²´ëª…</label><input type="text" id="input-company"></div>
                        <div class="form-group"><label>ëŒ€í‘œì (ê³µë™ëŒ€í‘œ ê°€ëŠ¥)</label><input type="text" id="input-ceo" placeholder="ì˜ˆ: í™ê¸¸ë™, ì´ìˆœì‹ "></div>
                        <div class="form-group"><label>ì—°ë½ì²˜</label><input type="text" id="input-phone"></div>
                        <div class="form-group"><label>ì—…ì¢…</label>
                            <select id="input-industry"><option value="">ì„ íƒ</option><option value="ì œì¡°">ì œì¡°</option><option value="ê±´ì„¤">ê±´ì„¤</option><option value="ë„ì†Œë§¤">ë„ì†Œë§¤</option><option value="ì„œë¹„ìŠ¤">ì„œë¹„ìŠ¤</option><option value="IT">IT</option></select>
                        </div>
                        <div class="form-group"><label>ë§¤ì¶œ ê·œëª¨</label>
                            <select id="input-revenue">
                                <option value="ë¯¸í™•ì¸">ë¯¸í™•ì¸</option>
                                <option value="1ì–µë¯¸ë§Œ">1ì–µ ë¯¸ë§Œ</option>
                                <option value="1ì–µ~3ì–µ">1ì–µ ~ 3ì–µ</option>
                                <option value="3ì–µì´ìƒ">3ì–µ ì´ìƒ</option>
                                <option value="5ì–µì´ìƒ">5ì–µ ì´ìƒ</option>
                                <option value="10ì–µì´ìƒ">10ì–µ ì´ìƒ</option>
                                <option value="30ì–µì´ìƒ">30ì–µ ì´ìƒ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin:0 0 20px 0; border-left:4px solid #f59e0b;">
                    <div class="section-label" style="color:#b45309;">2ë‹¨ê³„: ì „í™” ê²€ì¦</div>
                    <div class="form-grid">
                        <div class="form-group"><label>ëŒ€í‘œ ì‹ ìš©ì ìˆ˜</label>
                            <select id="input-credit"><option value="">ë¯¸í™•ì¸</option><option value="900ì´ìƒ">900ì  ì´ìƒ</option><option value="800ì´ìƒ">800ì  ì´ìƒ</option><option value="700ì´ìƒ">700ì  ì´ìƒ</option><option value="700ë¯¸ë§Œ">700ì  ë¯¸ë§Œ</option><option value="ì‚¬ê³ ì´ë ¥">ì‚¬ê³  ì´ë ¥</option></select>
                        </div>
                        <div class="form-group"><label>ì—°ë§¤ì¶œ (ë°±ë§Œì›)</label><input type="text" id="input-annual-rev" onkeyup="formatCurrency(this)" placeholder="ì˜ˆ: 1,000"></div>
                        <div class="form-group"><label>ì„¸ê¸ˆ ì²´ë‚©ì—¬ë¶€</label><select id="input-tax"><option value="ì™„ë‚©">ì™„ë‚©</option><option value="ë¶„ë‚©ì¤‘">ë¶„ë‚©ì¤‘</option><option value="ì—°ì²´ì¤‘">ì—°ì²´ì¤‘</option><option value="ê¸°íƒ€">ê¸°íƒ€</option></select></div>
                        <div class="form-group"><label>ì§€ì—­</label>
                            <select id="input-region"><option value="">ì„ íƒ</option><option value="ì„œìš¸">ì„œìš¸</option><option value="ê²½ê¸°">ê²½ê¸°</option><option value="ì¸ì²œ">ì¸ì²œ</option><option value="ë¶€ì‚°">ë¶€ì‚°</option><option value="ëŒ€êµ¬">ëŒ€êµ¬</option><option value="ê´‘ì£¼">ê´‘ì£¼</option><option value="ëŒ€ì „">ëŒ€ì „</option><option value="ìš¸ì‚°">ìš¸ì‚°</option><option value="ì„¸ì¢…">ì„¸ì¢…</option><option value="ê°•ì›">ê°•ì›</option><option value="ì¶©ë¶">ì¶©ë¶</option><option value="ì¶©ë‚¨">ì¶©ë‚¨</option><option value="ì „ë¶">ì „ë¶</option><option value="ì „ë‚¨">ì „ë‚¨</option><option value="ê²½ë¶">ê²½ë¶</option><option value="ê²½ë‚¨">ê²½ë‚¨</option><option value="ì œì£¼">ì œì£¼</option></select>
                        </div>
                        <div class="form-group"><label>ë¯¸íŒ… ì¼ì •</label><input type="date" id="input-meet-date" onclick="this.showPicker()"></div>
                    </div>
                </div>

                <div class="card" style="margin:0; border-left:4px solid #10b981;">
                    <div class="section-label" style="color:#047857;">3ë‹¨ê³„: ì§„í–‰ ë° ê³„ì•½</div>
                    <div class="form-group"><label>í˜„ì¬ ìƒíƒœ</label>
                        <select id="input-status" style="padding:12px; font-weight:bold;" onchange="toggleStatusFields()">
                            <option value="ëŒ€ê¸°">â³ ëŒ€ê¸°</option>
                            <option value="ì§„í–‰ì¤‘">ğŸƒ ì§„í–‰ì¤‘</option>
                            <option value="ê°€ë§ê³ ê°">ğŸŒŸ ê°€ë§ê³ ê°</option>
                            <option value="ê³„ì•½">ğŸ‰ ê³„ì•½</option>
                            <option value="ì¢…ë£Œ">âŒ ì¢…ë£Œ</option>
                        </select>
                    </div>

                    <div id="box-wait" class="dynamic-section"><div class="form-group"><label style="color:#64748b;">ëŒ€ê¸° ì‚¬ìœ </label><input type="text" id="input-wait-reason" placeholder="ëŒ€ê¸° ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></div></div>
                    <div id="box-ing" class="dynamic-section"><div class="form-group"><label style="color:#2563eb;">ì§„í–‰ ê³¼ì • ìƒì„¸</label><textarea id="input-ing-detail" rows="3" placeholder="ì§„í–‰ ìƒí™©ì„ ìƒì„¸íˆ ê¸°ë¡í•˜ì„¸ìš”."></textarea></div></div>
                    <div id="box-prospect" class="dynamic-section prospect-box"><div class="form-group"><label style="color:#7c3aed;">ğŸŒŸ ê°€ë§ê³ ê° ì„ ì • ì‚¬ìœ  ë° í¬ì¸íŠ¸</label><textarea id="input-prospect-detail" rows="3" placeholder="í•µì‹¬ í¬ì¸íŠ¸ì™€ ì˜ˆìƒ ê³„ì•½ ì‹œì "></textarea></div></div>
                    <div id="box-end" class="dynamic-section"><div class="form-group"><label style="color:#ef4444;">ì¢…ë£Œ/ê±°ì ˆ ì‚¬ìœ </label><input type="text" id="input-end-reason" placeholder="ì¢…ë£Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></div></div>

                    <div id="box-contract" class="dynamic-section contract-box">
                        <div class="form-grid">
                            <div class="form-group"><label>ê³„ì•½ ìƒí’ˆ</label><input type="text" id="input-product" placeholder="ì˜ˆ) êµë³´ê²½ì •"></div>
                            <div class="form-group"><label>ê³„ì•½ ê¸ˆì•¡ (ì›)</label><input type="text" id="input-amount" onkeyup="formatCurrency(this); calculateShare();" placeholder="ì½¤ë§ˆ ìë™"></div>
                        </div>
                        <div class="share-info" id="share-calculator">
                            <div style="font-weight:bold; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                                <span>ğŸ“Š ì‰ì–´ ê³„ì‚°ê¸° (ì´ì•¡ ëŒ€ë¹„ % í•©ì‚°)</span>
                                <span style="font-size:11px; color:#ef4444;">* ë³¸ì¸ ì‹¤ì ì€ ë¯¸ì…ë ¥ ì‹œ ìë™ ê³„ì‚°ë¨ (ì‰ì–´ìë§Œ ì…ë ¥)</span>
                            </div>
                            
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">1</span><select id="share-partner-1" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-1" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-1">0</span></div>
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">2</span><select id="share-partner-2" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-2" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-2">0</span></div>
                            <div class="share-row"><span style="font-size:11px; font-weight:bold; width:20px;">3</span><select id="share-partner-3" onchange="calculateShare()"><option value="">ì„ íƒ</option></select><input type="number" id="share-percent-3" placeholder="%" oninput="calculateShare()"> % <span class="share-val" id="share-val-3">0</span></div>

                            <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #e2e8f0; display:flex; justify-content:space-between; font-weight:bold;">
                                <span>ì´ì•¡: <span id="disp-total">0</span></span>
                                <span style="color:blue;">ë‚´ ì‹¤ì (ë‚˜ë¨¸ì§€): <span id="disp-net">0</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="btn-roadmap-area" style="display:none; margin-top:20px;">
                        <button class="btn btn-dark" style="width:100%; padding:15px; font-size:15px;" onclick="openRoadmapPopup()">
                            <i class="fa-solid fa-diagram-project"></i> ğŸ“… ì»¨ì„¤íŒ… ë¡œë“œë§µ ê´€ë¦¬ (ìƒˆì°½ ì—´ê¸°)
                        </button>
                    </div>

                    <div class="form-group" style="margin-top:15px;"><label>ìƒë‹´ë‚´ìš© ë° ì»¨ì„¤íŒ… ë°©í–¥ ê¸°ì¬</label><textarea id="input-consulting" rows="3"></textarea></div>
                </div>
            </div>

            <div class="panel-right">
                <h4>ğŸ•“ í™œë™ ë¡œê·¸</h4>
                <div style="font-size:12px; color:#64748b; margin-bottom:10px; background:#f1f5f9; padding:10px; border-radius:6px; line-height:1.4;">
                    ì˜ˆ) ë¶€ì¬ì¤‘, ì¥ë‚œDB, ~ì´ìœ ë¡œ í†µí™”ì¢…ê²°ê³¼ ë‚ ì§œë³„ ì§„í–‰ ì‚¬í•­ ê¸°ë¡ìœ¼ë¡œ ë‚¨ê¸¸ê²ƒ...
                </div>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input type="text" id="hist-input" placeholder="ë‚´ìš©" style="flex:1;" onkeypress="if(event.keyCode==13) addLog()">
                    <button onclick="addLog()" class="btn btn-primary">ë“±ë¡</button>
                </div>
                <div id="log-list" style="flex:1; overflow-y:auto; border-top:1px solid #eee; padding-top:10px;"></div>
                <div style="margin-top:auto; display:flex; gap:5px;">
                    <button onclick="saveData()" class="btn btn-primary" style="flex:1;">ì €ì¥</button>
                    <button onclick="deleteData()" class="btn btn-danger">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="roadmap-modal">
    <div class="modal-window">
        <div class="modal-header">
            <h3><i class="fa-solid fa-diagram-project"></i> ì»¨ì„¤íŒ… ë¡œë“œë§µ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h3>
            <button onclick="closeRoadmapPopup()" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div class="modal-body" style="background:#fff;">
            <div class="roadmap-toolbar" id="rm-toolbar">
                <div style="font-weight:800; margin-bottom:10px; color:#1e293b; display:flex; align-items:center; gap:5px;">
                    <i class="fa-solid fa-hand-pointer"></i> ë¹ ë¥¸ í•­ëª© ì¶”ê°€ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥)
                </div>
                <div class="roadmap-presets" id="rm-presets"></div>
                <div class="rm-input-row" id="rm-input-box">
                    <div class="rm-input-group" style="flex:2;">
                        <span class="rm-input-label">í•­ëª©ëª…</span>
                        <input type="text" id="rm-name" placeholder="í•­ëª© ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px; font-weight:bold;">
                    </div>
                    <div class="rm-input-group" style="flex:1;">
                        <span class="rm-input-label">ì‹œì‘ ì‹œì </span>
                        <select id="rm-start" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></select>
                    </div>
                    <div class="rm-input-group" style="flex:1;">
                        <span class="rm-input-label">ì¢…ë£Œ ì‹œì </span>
                        <select id="rm-end" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></select>
                    </div>
                    <div class="rm-input-group" style="flex:1;">
                        <span class="rm-input-label">í…ìŠ¤íŠ¸ ìœ„ì¹˜</span>
                        <select id="rm-align" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;">
                            <option value="center">ê°€ìš´ë° ì •ë ¬</option>
                            <option value="left">ì¢Œì¸¡ ì •ë ¬</option>
                            <option value="right">ìš°ì¸¡ ì •ë ¬</option>
                            <option value="out">ë°”ê¹¥ (ìš°ì¸¡)</option>
                        </select>
                    </div>
                    <div class="rm-input-group" style="flex:3;">
                        <span class="rm-input-label">ë³´ì¶© ì„¤ëª… (// ì…ë ¥ì‹œ ì¤„ë°”ê¿ˆ)</span>
                        <input type="text" id="rm-desc" placeholder="ì˜ˆ: ìš´ì „ìê¸ˆ 2ì–µ // (ë³´ì¦ë£Œ ì§€ì›)" style="padding:10px; border:1px solid #cbd5e1; border-radius:6px;">
                    </div>
                    
                    <div style="display:flex; flex-direction:column; gap:5px; margin-top:auto;">
                        <button class="btn btn-primary" id="btn-add-rm" style="height:42px;" onclick="addManualRoadmap()">
                            <i class="fa-solid fa-plus"></i> ì¶”ê°€
                        </button>
                        <button class="btn btn-secondary" id="btn-cancel-rm" style="height:30px; font-size:12px; display:none;" onclick="resetRoadmapInput()">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            </div>

            <div id="rm-list" style="margin-bottom:15px; font-size:13px; color:#666; min-height:30px; padding:10px; border:1px dashed #cbd5e1; border-radius:8px;"></div>

            <div class="rm-container">
                <div id="roadmap-print-area">
                    <style>
                        .rm-title-edit { text-align:center; color:#1e293b; margin-bottom:40px; font-family:'Pretendard', sans-serif; font-size: 32px; font-weight: 900; border: 2px dashed transparent; border-radius: 8px; padding: 10px; transition: 0.2s; cursor: text; outline:none; }
                        .rm-title-edit:hover, .rm-title-edit:focus { border-color: #cbd5e1; background: #f8fafc; }
                        .rm-title-edit.placeholder { color: #cbd5e1; }
                        .rm-table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 12px; font-family: 'Pretendard', sans-serif; }
                        .rm-header { background: #1e3a8a; color: white; text-align: center; font-weight: bold; padding: 12px 0; border: 1px solid #94a3b8; }
                        .rm-subheader { background: #3b82f6; color: white; text-align: center; font-size: 11px; padding: 6px 0; border: 1px solid #94a3b8; }
                        .rm-cell { border: 1px solid #cbd5e1; height: 55px; position: relative; padding: 0; background: white; }
                        .rm-cat-col { width: 120px; text-align: center; font-weight: 800; vertical-align: middle; border: 1px solid #94a3b8; color: white; font-size: 12.5px; padding: 5px; word-break: keep-all; white-space: normal; line-height: 1.3; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
                        .rm-diagonal { background: linear-gradient(to top right, #f1f5f9 49.5%, #94a3b8 50%, #f1f5f9 50.5%); position: relative; padding: 0; border: 1px solid #94a3b8; }
                        .rm-diagonal-text { position: absolute; font-size: 11px; font-weight: bold; color: #334155; }
                        .rm-text-bottom-left { bottom: 5px; left: 8px; }
                        .rm-text-top-right { top: 5px; right: 8px; }
                        .rm-bar-container { position: absolute; top: 10px; bottom: 10px; border-radius: 15px; display: flex; align-items: center; color: white; font-size: 12px; font-weight: bold; box-shadow: 2px 3px 6px rgba(0,0,0,0.15); white-space: normal; overflow: hidden; z-index: 10; line-height:1.2; }
                        .rm-align-left { justify-content: flex-start; padding-left: 10px; text-align: left; }
                        .rm-align-center { justify-content: center; text-align: center; padding: 0 5px; }
                        .rm-align-right { justify-content: flex-end; padding-right: 10px; text-align: right; }
                        .rm-bar-text { text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
                        .rm-bar-outer-text { position: absolute; top: 50%; transform: translateY(-50%); left: 105%; width: 200px; font-size: 11px; font-weight: bold; color: #334155; z-index: 5; line-height:1.3; text-align:left; display: flex; flex-direction: column; justify-content: center; }
                        .bg-grad-0 { background: #0f172a; } .bg-grad-1 { background: #1e3a8a; } .bg-grad-2 { background: #1d4ed8; } .bg-grad-3 { background: #3b82f6; } .bg-grad-4 { background: #60a5fa; } .bg-grad-5 { background: #93c5fd; color:#1e293b !important; text-shadow:none !important; } 
                    </style>
                    <div contenteditable="true" id="print-company-name" class="rm-title-edit" spellcheck="false" onclick="if(this.classList.contains('placeholder')) { this.innerText=''; this.classList.remove('placeholder'); }">Project Schedule</div>
                    <div style="font-size:14px; color:#64748b; font-weight:normal; margin-bottom:20px; text-align:right;" id="print-member-name">ì˜¤ë„ˆìŠ¤ê²½ì˜ì—°êµ¬ì†Œ - í™ê¸¸ë™ íŒ€ì¥</div>
                    <div style="overflow-x:auto;">
                        <table class="rm-table"><thead><tr id="rm-header-row-1"><th class="rm-header rm-diagonal" style="width:120px;" rowspan="2"><span class="rm-diagonal-text rm-text-bottom-left">í•­ëª©</span><span class="rm-diagonal-text rm-text-top-right">ì¼ì •</span></th></tr><tr id="rm-header-row-2"></tr></thead><tbody id="rm-body"></tbody></table>
                    </div>
                </div>
            </div>
            <div style="margin-top:auto; display:flex; justify-content:flex-end; gap:10px; padding-top:20px; border-top:1px solid #eee;">
                <button class="btn btn-primary" style="padding:15px 30px; font-size:16px;" onclick="saveRoadmap()">ì €ì¥ í›„ ë‹«ê¸°</button>
                <button class="btn btn-dark" style="padding:15px 30px; font-size:16px;" onclick="printRoadmap()"><i class="fa-solid fa-print"></i> ë¡œë“œë§µ ì¸ì‡„</button>
            </div>
        </div>
    </div>
</div>

<script>
    // [â˜…ì¤‘ìš”â˜…] ë³µì‚¬í•œ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì›¹ ì•± URL ì ìš© ì™„ë£Œ (ì¤„ë°”ê¿ˆ ì˜¤ë¥˜ ìˆ˜ì •ë¨)
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxtIDHngQPcfw7oVu9LQgY7YIoR-VG_TW9j6rTXQYOP0bI_0lqf_amUHjwkw6juxasm/exec'; 
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤ (ì‚¬ìš©ì ë¡œê·¸ì¸ ì •ë³´ ë° ë©¤ë²„ ëª…ë‹¨ìš©)
    const MEMBER_KEY = 'dbProMembers_v21';
    const defaultMembers = ["ë°•ì •ìµ", "ì´ìƒí˜„", "ê¹€ì°¬ìš±", "ì´ê²½ì—´", "ê¹€ê²½ì„ ", "ì„ì„ í˜¸", "ì´í˜œì„±", "ê¹€ìƒê²½", "ê¹€ì„¸ëª©", "ìœ¤ì¢…ìš±", "ê¹€ì¢…ì›", "ì„ë³µìš©", "ì§„í•™ê· ", "ê³ ì¬ì›", "ì¶”ì¥í˜¸", "í•œì˜ì¤€", "ê´€ë¦¬ì"];
    
    let members = JSON.parse(localStorage.getItem(MEMBER_KEY)) || defaultMembers;
    let dbList = []; // ì´ì œ ì„œë²„ì—ì„œ ë°›ì•„ì˜µë‹ˆë‹¤.
    let userCreds = JSON.parse(localStorage.getItem('dbProCreds')) || {};
    let currentUser = null;
    let tempLogs = [];
    let currentId = null;
    let historyTab = 'prospect';
    let isAdminLogAdded = false; 
    let tempRoadmap = []; 
    let editIndex = -1;
    let dragSrcEl = null;
    let dragSrcIndex = null;

    const roadmapItems = ["ì‹ ë³´", "ê¸°ë³´", "ì‹ ìš©ë³´ì¦ì¬ë‹¨", "ì†Œì§„ê³µ", "ì¤‘ì§„ê³µ", "ë²•ì¸ì„¤ë¦½(ì „í™˜)", "íŠ¹í—ˆ", "ë²¤ì²˜ì¸ì¦", "ì—°êµ¬ì „ë‹´ë¶€ì„œì„¤ë¦½", "ì¬ë¬´ë“±ê¸‰ê´€ë¦¬"];
    const colorPalette = ['#0f172a', '#1e3a8a', '#1d4ed8', '#3b82f6', '#60a5fa', '#93c5fd'];

    window.onload = function() {
        // [ë¡œê·¸ì¸ ì •ë³´ ë³µêµ¬ ë¡œì§ - ìš”ì²­ì‚¬í•­ ë°˜ì˜]
        const lastId = localStorage.getItem('last_login_id');
        const lastPw = localStorage.getItem('last_login_pw');
        if(lastId) {
            document.getElementById('login-user-name').value = lastId;
            document.getElementById('login-pw').value = lastPw;
            document.getElementById('login-remember').checked = true;
        }
        initDateSelects(); 
    };

    function showLoading() { document.getElementById('loading-overlay').style.display = 'flex'; }
    function hideLoading() { document.getElementById('loading-overlay').style.display = 'none'; }

    // [ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ í•¨ìˆ˜]
    function toggleMobileMenu() {
        const sidebar = document.getElementById('app-sidebar');
        const overlay = document.getElementById('mobile-sidebar-overlay');
        
        // PC í™”ë©´ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•Šë„ë¡ ë°©ì–´
        if(window.innerWidth > 768) return;

        if (sidebar.classList.contains('active')) {
            sidebar.classList.remove('active');
            overlay.style.display = 'none';
        } else {
            sidebar.classList.add('active');
            sidebar.style.display = 'flex'; // display:none ìƒíƒœì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°•ì œ í‘œì‹œ
            overlay.style.display = 'block';
        }
    }

    // [ì„œë²„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° + ë°ì´í„° êµ¬ì¡° ìë™ í˜¸í™˜ íŒ¨ì¹˜]
    function fetchDB(callback) {
        if(!GAS_URL || GAS_URL.includes('URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”')) {
            alert('ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ í›„ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        showLoading();
        fetch(GAS_URL)
        .then(res => res.json())
        .then(data => {
            // [â˜…ì •êµí•œ ìˆ˜ì •] ì„œë²„ ì‘ë‹µì´ ë°°ì—´(êµ¬ë²„ì „)ì¸ì§€ ê°ì²´(ì‹ ë²„ì „)ì¸ì§€ ìë™ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ ì²˜ë¦¬
            if (Array.isArray(data)) {
                dbList = data; // êµ¬ë²„ì „ ìŠ¤í¬ë¦½íŠ¸ ì‘ë‹µ(ë°°ì—´)ì¼ ê²½ìš°
            } else if (data && data.db) {
                dbList = data.db; // ì‹ ë²„ì „ ìŠ¤í¬ë¦½íŠ¸ ì‘ë‹µ(ê°ì²´)ì¼ ê²½ìš°
            } else {
                dbList = []; // ë°ì´í„° ì—†ìŒ
            }

            // [ì •ë ¬] ID(ì‹œê°„ê°’) ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ ìœ ì§€)
            dbList.sort((a, b) => {
                const idA = Number(a.id) || 0;
                const idB = Number(b.id) || 0;
                return idB - idA;
            });
            
            hideLoading();
            if(callback) callback();
        })
        .catch(err => {
            hideLoading();
            console.error(err);
            alert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err);
        });
    }
    function attemptLogin(type) {
        const inputName = document.getElementById('login-user-name').value.trim();
        const inputPw = document.getElementById('login-pw').value;

        // 1. ê´€ë¦¬ì ì ‘ì† ë¡œì§
        if (type === 'admin') {
            const adminName = 'ê´€ë¦¬ì';
            const adminPw = userCreds[adminName] || "1234";
            if (!inputPw) { alert("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); document.getElementById('login-pw').focus(); return; }
            if (inputPw !== adminPw) { alert("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); document.getElementById('login-pw').value = ''; document.getElementById('login-pw').focus(); return; }
            processLoginSuccess(adminName, inputPw);
            return;
        }

        // 2. ì¼ë°˜ íŒ€ì› ì ‘ì† ë¡œì§
        if (!inputName) { alert("ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); document.getElementById('login-user-name').focus(); return; }
        if (!members.includes(inputName) || inputName === 'ê´€ë¦¬ì') { alert("ë“±ë¡ë˜ì§€ ì•Šì€ íŒ€ì›ì…ë‹ˆë‹¤. ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const savedPw = userCreds[inputName] || "1234";
        if (inputPw !== savedPw) { alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }

        processLoginSuccess(inputName, inputPw);
    }

    function processLoginSuccess(user, pw) {
        currentUser = { name: user, role: user==='ê´€ë¦¬ì'?'admin':'member' };
        
        // [ë¡œê·¸ì¸ ì •ë³´ ì €ì¥ ë¡œì§ - ìš”ì²­ì‚¬í•­ ë°˜ì˜]
        const isRemember = document.getElementById('login-remember').checked;
        if(isRemember) {
            localStorage.setItem('last_login_id', user);
            localStorage.setItem('last_login_pw', pw);
        } else {
            localStorage.removeItem('last_login_id');
            localStorage.removeItem('last_login_pw');
        }

        document.getElementById('login-screen').style.display='none';
        document.getElementById('app-sidebar').style.display='flex';
        document.getElementById('app-main').style.display='flex';
        document.getElementById('profile-name').innerText = user;
        document.getElementById('profile-role').innerText = user === 'ê´€ë¦¬ì' ? 'Admin Master' : 'Team Leader';
        
        document.getElementById('page-title').innerText = (user === 'ê´€ë¦¬ì') ? 'íŒ€ì› DB ê´€ë¦¬' : 'ë‚˜ì˜ DB ê´€ë¦¬';
        document.getElementById('menu-list-text').innerText = (user === 'ê´€ë¦¬ì') ? 'íŒ€ì› DB ê´€ë¦¬' : 'ë‚˜ì˜ DB ê´€ë¦¬';
        document.getElementById('menu-hist-text').innerText = (user === 'ê´€ë¦¬ì') ? 'í†µí•© íˆìŠ¤í† ë¦¬' : 'ì›”ë³„ íˆìŠ¤í† ë¦¬';

        if(user === 'ê´€ë¦¬ì') {
            document.getElementById('app-sidebar').classList.add('admin-mode');
            document.getElementById('admin-menu').style.display='block';
            document.getElementById('admin-yoy-summary').style.display='block';
            document.getElementById('btn-add-member').style.display='flex'; 
            document.getElementById('btn-del-member').style.display='flex';
        } else {
            document.getElementById('app-sidebar').classList.remove('admin-mode');
            document.getElementById('admin-menu').style.display='none';
            document.getElementById('admin-yoy-summary').style.display='none';
            document.getElementById('btn-add-member').style.display='none';
            document.getElementById('btn-del-member').style.display='none';
        }
        setupHistoryTabs();
        
        // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetchDB(() => { navTo('list'); });
    }

    // [â˜…ê´€ë¦¬ì í•„í„° ë²„ê·¸ ìˆ˜ì • í¬í•¨]
    function renderFilters() {
        const container = document.getElementById('list-filter-container');
        if(!container) return; 

        if(currentUser.role === 'admin') {
            let html = `
                <select id="filter-year" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()"></select>
                <select id="filter-month" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()"></select>
                <select id="filter-source" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()">
                    <option value="all">ì „ì²´ ì¶œì²˜</option>
                    <option value="íšŒì‚¬DB">íšŒì‚¬ DB</option>
                    <option value="ê°œì¸DB">ê°œì¸ DB</option>
                    <option value="íŒ€DB">íŒ€ DB</option>
                    <option value="ì‰ì–´ë°›ìŒ">ì‰ì–´ ë°›ìŒ (ì „ì²´)</option>
                </select>
                <select id="filter-status" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()">
                    <option value="all">ì „ì²´ ìƒíƒœ</option>
                    <option value="ëŒ€ê¸°">â³ ëŒ€ê¸°</option>
                    <option value="ì§„í–‰ì¤‘">ğŸƒ ì§„í–‰ì¤‘</option>
                    <option value="ê°€ë§ê³ ê°">ğŸŒŸ ê°€ë§ê³ ê°</option>
                    <option value="ê³„ì•½">ğŸ‰ ê³„ì•½</option>
                    <option value="ì¢…ë£Œ">âŒ ì¢…ë£Œ</option>
                </select>
                <select id="filter-member" style="padding:10px; border:1px solid #2563eb; color:#2563eb; font-weight:bold; border-radius:8px;" onchange="renderList()">
                    <option value="all">ì „ì²´ íŒ€ì› ë³´ê¸°</option>
                </select>
            `;
            container.innerHTML = html;
            const memSel = document.getElementById('filter-member');
            
            // [â˜…ìˆ˜ì •] ê´€ë¦¬ì ë³¸ì¸ë„ í•„í„° ëª©ë¡ì— ì¶”ê°€
            members.forEach(m => { 
                memSel.innerHTML += `<option value="${m}">${m}</option>`; 
            });
            
        } else {
            let html = `
                <input type="text" id="search-keyword" placeholder="ì—…ì²´ëª… ê²€ìƒ‰" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:8px;" onkeyup="renderList()">
                <select id="filter-year" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()"></select>
                <select id="filter-month" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()"></select>
                <select id="filter-source" style="padding:10px; border:1px solid #ddd; border-radius:8px;" onchange="renderList()">
                    <option value="all">ì „ì²´ ì¶œì²˜</option>
                    <option value="íšŒì‚¬DB">íšŒì‚¬ DB</option>
                    <option value="ê°œì¸DB">ê°œì¸ DB</option>
                    <option value="íŒ€DB">íŒ€ DB</option>
                    <option value="ì‰ì–´ë°›ìŒ">ì‰ì–´ ë°›ìŒ (ì „ì²´)</option>
                </select>
            `;
            container.innerHTML = html;
        }
        initDateSelects(); 
    }

    function initDateSelects() {
        const yearSel = document.getElementById('filter-year');
        const monthSel = document.getElementById('filter-month');
        // ë‹¤ë¥¸ ë·°ì˜ ì…€ë ‰íŠ¸ë“¤ë„ ì•ˆì „í•˜ê²Œ ì°¸ì¡°
        const histYearSel = document.getElementById('hist-year');
        const histMonthSel = document.getElementById('hist-month');
        const adminMonthSel = document.getElementById('admin-stat-month');
        
        const currentYear = new Date().getFullYear();
        const currentMonth = new Date().getMonth() + 1;
        
        let opts = `<option value="all">ì „ì²´ ì—°ë„</option>`;
        for(let y = currentYear + 1; y >= 2023; y--) opts += `<option value="${y}" ${y===currentYear?'selected':''}>${y}ë…„</option>`;
        
        if(yearSel) yearSel.innerHTML = opts;
        if(histYearSel) histYearSel.innerHTML = opts.replace('value="all"', 'value="'+currentYear+'"');
        
        let mOpts = `<option value="all">ì „ì²´ ì›”</option>`;
        for(let m=1; m<=12; m++) mOpts += `<option value="${m}">${m}ì›”</option>`;
        
        if(monthSel) monthSel.innerHTML = mOpts;
        if(histMonthSel) histMonthSel.innerHTML = `<option value="all">ì „ì²´ (1ë…„ì¹˜)</option>` + mOpts.replace('value="all"','').replace('ì „ì²´ ì›”','');
        if(adminMonthSel) adminMonthSel.innerHTML = mOpts.replace('value="all"', `value="${currentMonth}" selected`);
    }

    function addTeamMember() {
        const newName = prompt("ìƒˆë¡œìš´ íŒ€ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
        if(newName && !members.includes(newName)) {
            members.splice(members.length-1, 0, newName); 
            localStorage.setItem(MEMBER_KEY, JSON.stringify(members));
            alert("íŒ€ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
            refreshMemberRelatedUI();
        } else if(members.includes(newName)) {
            alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.");
        }
    }

    function deleteTeamMember() {
        const target = prompt("ì‚­ì œí•  íŒ€ì› ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:\n(í˜„ì¬ ëª…ë‹¨: " + members.filter(m=>m!=='ê´€ë¦¬ì').join(', ') + ")");
        if(target && members.includes(target)) {
            if(target === 'ê´€ë¦¬ì') return alert("ê´€ë¦¬ìëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            if(!confirm(`ì •ë§ '${target}' íŒ€ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní•´ë‹¹ íŒ€ì›ì˜ DBëŠ” ë³´ì¡´ë˜ì§€ë§Œ ë¡œê·¸ì¸ì€ ë¶ˆê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.`)) return;
            members = members.filter(m => m !== target);
            localStorage.setItem(MEMBER_KEY, JSON.stringify(members));
            alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            refreshMemberRelatedUI(); 
        } else if(target) {
            alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒ€ì›ì…ë‹ˆë‹¤.");
        }
    }

    function refreshMemberRelatedUI() {
        if(currentUser.role === 'admin' && document.getElementById('filter-member')) {
            const memSel = document.getElementById('filter-member');
            const currentVal = memSel.value;
            memSel.innerHTML = '<option value="all">ì „ì²´ íŒ€ì› ë³´ê¸°</option>';
            members.forEach(m => { memSel.innerHTML += `<option value="${m}">${m}</option>`; });
            if(members.includes(currentVal) || currentVal === 'all') {
                memSel.value = currentVal;
            } else {
                memSel.value = 'all';
                renderList(); 
            }
        }
        if(document.getElementById('modal').style.display === 'flex') {
            updateShareFields();
        }
        if(document.getElementById('view-analysis').style.display === 'block') renderAnalysisData();
        if(document.getElementById('view-dashboard').style.display === 'block') renderAdminDashboard();
    }

    function setupHistoryTabs() {
        const div = document.getElementById('history-tabs');
        if(currentUser.role === 'admin') {
            div.innerHTML = `<button class="btn" id="tab-admin-prospect" onclick="switchHistoryTab('admin-prospect')">ğŸŒŸ ê°€ë§ê³ ê°</button><button class="btn" id="tab-contract" onclick="switchHistoryTab('contract')">ğŸ¤ ê³„ì•½ ê³ ê°</button>`;
            switchHistoryTab('admin-prospect');
        } else {
            div.innerHTML = `<button class="btn" id="tab-prospect" onclick="switchHistoryTab('prospect')">ğŸŒŸ ê°€ë§ê³ ê°</button><button class="btn" id="tab-contract" onclick="switchHistoryTab('contract')">ğŸ¤ ê³„ì•½ ê³ ê°</button>`;
            switchHistoryTab('prospect');
        }
    }

    function switchHistoryTab(t) {
        historyTab = t;
        const allTabs = ['prospect', 'contract', 'admin-prospect']; 
        allTabs.forEach(tabKey => {
            const btn = document.getElementById('tab-' + tabKey);
            if(btn) {
                if(tabKey === t) { btn.style.background = 'var(--primary)'; btn.style.color = 'white'; } 
                else { btn.style.background = 'white'; btn.style.color = '#333'; }
            }
        });
        renderHistory();
    }

    function navTo(page) {
        if(page === 'dashboard' && currentUser.role !== 'admin') return alert("ê´€ë¦¬ì ê¶Œí•œ í•„ìš”");
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const map = { 'list': 'nav-list', 'analysis': 'nav-analysis', 'history': 'nav-history', 'dashboard': 'nav-dashboard' };
        if(document.getElementById(map[page])) document.getElementById(map[page]).classList.add('active');
        document.querySelectorAll('.page-content').forEach(el => el.style.display = 'none');
        document.getElementById('view-' + page).style.display = 'block';

        if(page === 'list') {
            renderFilters(); 
            if(currentUser.role === 'admin') {
                document.getElementById('list-head').innerHTML = `<tr><th>ì ‘ìˆ˜ì¼</th><th>ë‹´ë‹¹ì</th><th>ë¯¸íŒ…ì¼</th><th>ì¶œì²˜</th><th>ì—…ì²´ëª…</th><th>ì§€ì—­</th><th>ìƒíƒœ</th></tr>`;
            } else {
                document.getElementById('list-head').innerHTML = `<tr><th>ì ‘ìˆ˜ì¼</th><th>ë¯¸íŒ…ì¼</th><th>ì¶œì²˜</th><th>ì—…ì²´ëª…</th><th>ì—…ì¢…</th><th>ì§€ì—­</th><th>ìƒíƒœ</th></tr>`;
            }
            renderList();
        }
        if(page === 'analysis') renderAnalysisData();
        if(page === 'dashboard') renderAdminDashboard();
        if(page === 'history') renderHistory();
    }

    // [â˜…ìˆ˜ì •ë¨] 2ë‹¨ê³„ ê°•ë ¥ ì •ë ¬ ë¡œì§ ë° ë‚ ì§œ íŒŒì‹± ê°•í™” (ëˆ„ë½ í•´ê²°)
    function renderList() {
        const tbody = document.getElementById('list-body'); 
        if(!tbody) return;

        const yearEl = document.getElementById('filter-year');
        const monthEl = document.getElementById('filter-month');
        const sourceEl = document.getElementById('filter-source');
        if(!yearEl || !monthEl || !sourceEl) return;

        tbody.innerHTML = '';
        const year = yearEl.value;
        const month = monthEl.value;
        const source = sourceEl.value;
        
        let kw = '';
        let statusFilter = 'all';
        let targetMem = currentUser.name;

        if(currentUser.role === 'admin') {
            const statusEl = document.getElementById('filter-status');
            const memberEl = document.getElementById('filter-member');
            if(statusEl) statusFilter = statusEl.value;
            if(memberEl) targetMem = memberEl.value; 
            else targetMem = 'all'; 
        } else {
            const searchEl = document.getElementById('search-keyword');
            kw = searchEl ? searchEl.value.toLowerCase() : '';
        }

        // 1. í•„í„°ë§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€ + ë‚ ì§œ íŒŒì‹± ê°•í™”)
        let filtered = dbList.filter(d => {
            if (!d) return false; 
            
            // [â˜…í•µì‹¬ ìˆ˜ì •] ë‚ ì§œ í˜•ì‹ì´ ë‹¤ì–‘í•´ë„ ê°•ì œë¡œ ì—°/ì›” ì¶”ì¶œ
            let dYear, dMonth;
            try {
                // 1. í‘œì¤€ ë‚ ì§œ ê°ì²´ ìƒì„± ì‹œë„
                let dateObj = new Date(d.date);
                
                // 2. ë§Œì•½ ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œë¼ë©´ (Invalid Date), ë¬¸ìì—´ íŒŒì‹± ì‹œë„
                if (isNaN(dateObj.getTime())) {
                    // ì˜ˆ: "2026. 1. 15" ë˜ëŠ” "2026/01/15" í˜•íƒœ ì²˜ë¦¬
                    const parts = d.date.match(/(\d{4})[\.\-\/]\s?(\d{1,2})[\.\-\/]\s?(\d{1,2})/);
                    if (parts) {
                        dYear = parseInt(parts[1]);
                        dMonth = parseInt(parts[2]);
                    } else {
                        // ë‚ ì§œë¥¼ ë„ì €íˆ ì•Œ ìˆ˜ ì—†ìœ¼ë©´ í•„í„°ë§ì—ì„œ ì œì™¸í•˜ê±°ë‚˜ í¬í•¨ (ì—¬ê¸°ì„  í¬í•¨)
                        dYear = 0; dMonth = 0; 
                    }
                } else {
                    dYear = dateObj.getFullYear();
                    dMonth = dateObj.getMonth() + 1;
                }
            } catch (e) {
                dYear = 0; dMonth = 0;
            }

            if(year !== 'all' && dYear != year) return false;
            if(month !== 'all' && dMonth != month) return false;
            
            const dSource = d.source || ""; 
            if(source === 'ì‰ì–´ë°›ìŒ') {
                 if(!dSource.includes('ì‰ì–´')) return false; 
            } else if(source !== 'all' && dSource !== source) {
                return false;
            }
            
            if(currentUser.role === 'admin') {
                if(statusFilter !== 'all' && d.status !== statusFilter) return false;
                if(targetMem !== 'all' && d.member !== targetMem) return false;
            } else {
                if(d.member !== currentUser.name) return false;
                const dComp = (d.company || "").toLowerCase();
                if(kw && !dComp.includes(kw)) return false;
            }
            return true;
        });

        // [â˜…í•µì‹¬] ì´ì¤‘ ì •ë ¬ ë¡œì§ (Double Sort)
        // 1ìˆœìœ„: ì ‘ìˆ˜ì¼(Date) ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ)
        // 2ìˆœìœ„: ê°™ì€ ë‚ ì§œë¼ë©´ ID(ì‹œê°„ê°’) ë‚´ë¦¼ì°¨ìˆœ (ë°©ê¸ˆ ì…ë ¥í•œê²Œ ìœ„ë¡œ)
        filtered.sort((a, b) => {
            // ë‚ ì§œ ë¹„êµë¥¼ ìœ„í•´ ë¬¸ìì—´ì„ ì •ë¦¬
            const cleanDate = (str) => {
                if (!str) return 0;
                // "2026. 1. 15" -> "2026-01-15" í˜•íƒœë¡œ ë³€í™˜ ì‹œë„
                const parts = str.match(/(\d{4})[\.\-\/]\s?(\d{1,2})[\.\-\/]\s?(\d{1,2})/);
                if (parts) return new Date(`${parts[1]}-${parts[2]}-${parts[3]}`).getTime();
                return new Date(str).getTime();
            };

            const dateA = cleanDate(a.date) || 0;
            const dateB = cleanDate(b.date) || 0;
            
            if (dateB !== dateA) {
                return dateB - dateA; // ë‚ ì§œê°€ ë‹¤ë¥´ë©´ ë‚ ì§œìˆœ ì •ë ¬
            } else {
                // ë‚ ì§œê°€ ê°™ìœ¼ë©´ ID(ë“±ë¡ì‹œê°„)ìˆœ ì •ë ¬
                const idA = Number(a.id) || 0;
                const idB = Number(b.id) || 0;
                return idB - idA;
            }
        });

        // 2. ê·¸ë¦¬ê¸°
        filtered.forEach(d => {
            let badge = 'status-wait';
            if(d.status === 'ì§„í–‰ì¤‘') badge = 'status-ing';
            if(d.status === 'ê°€ë§ê³ ê°') badge = 'status-prospect';
            if(d.status === 'ê³„ì•½') badge = 'status-done';
            if(d.status === 'ì¢…ë£Œ') badge = 'status-end';
            if((d.source || "").includes('ì‰ì–´')) badge = 'status-share';
            
            let alertIcon = '';
            if(currentUser.role !== 'admin' && d.hasAdminAlert) {
                alertIcon = ` <i class="fa-solid fa-bell" style="color:#ef4444; margin-left:5px;" title="ê´€ë¦¬ì ì½”ë©˜íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤"></i>`;
            }

            let row = `<td>${d.date}</td>`;
            if(currentUser.role === 'admin') row += `<td>${d.member}</td>`;
            row += `<td style="color:${d.meetDate?'#2563eb':'#cbd5e1'}">${d.meetDate || '-'}</td><td>${d.source}</td><td style="font-weight:bold">${d.company}${alertIcon}</td>${currentUser.role !== 'admin' ? `<td>${d.industry||'-'}</td>` : ''} <td>${d.region || '-'}</td><td><span class="badge ${badge}">${d.status}</span></td>`;
            tbody.innerHTML += `<tr onclick="openModal('${d.id}')">${row}</tr>`;
        });
    }

    function toggleGradeField() { document.getElementById('group-grade-prov').style.display = (document.getElementById('input-source').value === 'íšŒì‚¬DB') ? 'block' : 'none'; }
    function toggleStatusFields() {
        const s = document.getElementById('input-status').value;
        document.querySelectorAll('.dynamic-section').forEach(el=>el.classList.remove('active'));
        if(s==='ëŒ€ê¸°') document.getElementById('box-wait').classList.add('active');
        if(s==='ì§„í–‰ì¤‘') document.getElementById('box-ing').classList.add('active');
        if(s==='ê°€ë§ê³ ê°') document.getElementById('box-prospect').classList.add('active');
        if(s==='ê³„ì•½') { document.getElementById('box-contract').classList.add('active'); calculateShare(); }
        if(s==='ì¢…ë£Œ') document.getElementById('box-end').classList.add('active');
        const showRoadmap = (s === 'ì§„í–‰ì¤‘' || s === 'ê³„ì•½');
        document.getElementById('btn-roadmap-area').style.display = showRoadmap ? 'block' : 'none';
    }

    function updateShareFields() {
        const source = document.getElementById('input-source').value;
        const selectors = [1,2,3].map(i => document.getElementById(`share-partner-${i}`));
        const inputs = [1,2,3].map(i => document.getElementById(`share-percent-${i}`));
        let commonOptions = `<option value="">ì„ íƒ</option>`;
        members.forEach(m => { if(m!=='ê´€ë¦¬ì') commonOptions += `<option value="${m}">${m} íŒ€ì¥</option>`; });
        selectors.forEach(sel => {
            const currentVal = sel.value; 
            let finalOptions = commonOptions;
            if(source === 'íšŒì‚¬DB') finalOptions = `<option value="">ì„ íƒ</option><option value="íšŒì‚¬">ğŸ¢ íšŒì‚¬</option>` + commonOptions.replace('<option value="">ì„ íƒ</option>','');
            if(source === 'íŒ€DB') finalOptions = `<option value="">ì„ íƒ</option><option value="SM">ğŸ—£ï¸ SM</option>` + commonOptions.replace('<option value="">ì„ íƒ</option>','');
            sel.innerHTML = finalOptions;
            sel.value = currentVal; 
            sel.disabled = false;
        });
        if(source === 'íšŒì‚¬DB') {
            selectors[0].value = 'íšŒì‚¬'; selectors[0].disabled = true;
            inputs[0].value = 10; inputs[0].readOnly = true;
        } else if(source === 'íŒ€DB') {
            selectors[0].value = 'SM'; selectors[0].disabled = true;
            inputs[0].value = 30; inputs[0].readOnly = true;
        } else {
             selectors[0].value = ''; selectors[0].disabled = false;
             inputs[0].value = ''; inputs[0].readOnly = false;
        }
    }

    function calculateShare() {
        const total = parseInt(document.getElementById('input-amount').value.replace(/,/g,''))||0;
        let totalDeduction = 0; 
        for(let i=1; i<=3; i++) {
            const partnerSel = document.getElementById(`share-partner-${i}`);
            const percentIn = document.getElementById(`share-percent-${i}`);
            const valSpan = document.getElementById(`share-val-${i}`);
            const source = document.getElementById('input-source').value;
            if(i===1) {
                if(source==='íšŒì‚¬DB') { percentIn.value=10; partnerSel.value='íšŒì‚¬'; }
                if(source==='íŒ€DB') { percentIn.value=30; partnerSel.value='SM'; }
            }
            const pct = parseInt(percentIn.value) || 0;
            let shareAmt = 0;
            if(pct > 0 && partnerSel.value) { shareAmt = Math.floor(total * (pct / 100)); }
            valSpan.innerText = shareAmt.toLocaleString();
            valSpan.style.color = shareAmt > 0 ? '#ef4444' : '#ccc';
            totalDeduction += shareAmt;
        }
        const myNet = total - totalDeduction;
        document.getElementById('disp-total').innerText = total.toLocaleString();
        document.getElementById('disp-net').innerText = myNet.toLocaleString();
    }

    function openRoadmapPopup() {
        document.getElementById('roadmap-modal').style.display = 'flex';
        resetRoadmapInput();
        const comp = document.getElementById('input-company').value.trim();
        const titleEdit = document.getElementById('print-company-name');
        if(comp) { titleEdit.innerText = comp + " Project Schedule"; titleEdit.classList.remove('placeholder'); } 
        else { titleEdit.innerText = "Project Schedule"; titleEdit.classList.add('placeholder'); }
        const mem = document.getElementById('display-member').innerText || "ë‹´ë‹¹ì";
        document.getElementById('print-member-name').innerText = `ì˜¤ë„ˆìŠ¤ê²½ì˜ì—°êµ¬ì†Œ - ${mem} íŒ€ì¥`;
        renderRoadmapView(); 
    }
    function closeRoadmapPopup() { document.getElementById('roadmap-modal').style.display = 'none'; }
    function initRoadmapInputs() {
        const startSel = document.getElementById('rm-start');
        const endSel = document.getElementById('rm-end');
        const presetDiv = document.getElementById('rm-presets');
        presetDiv.innerHTML = '';
        roadmapItems.forEach(item => { presetDiv.innerHTML += `<button class="btn-preset" onclick="setPresetName('${item}')">${item}</button>`; });
        startSel.innerHTML = ''; endSel.innerHTML = '';
        const baseYear = 2026; 
        for(let y=0; y<5; y++) { 
            for(let m=1; m<=12; m++) {
                const val = (y*12) + m; 
                const label = `${baseYear+y}ë…„ ${m}ì›”`;
                startSel.innerHTML += `<option value="${val}">${label}</option>`;
                endSel.innerHTML += `<option value="${val}">${label}</option>`;
            }
        }
    }
    function setPresetName(name) {
        const input = document.getElementById('rm-name');
        input.value = name; input.focus();
        document.querySelectorAll('.btn-preset').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }
    function resetRoadmapInput() {
        initRoadmapInputs();
        document.getElementById('rm-name').value = '';
        document.getElementById('rm-start').value = 1;
        document.getElementById('rm-end').value = 1;
        document.getElementById('rm-desc').value = '';
        document.getElementById('rm-align').value = 'center';
        editIndex = -1;
        document.getElementById('btn-add-rm').innerHTML = '<i class="fa-solid fa-plus"></i> ì¶”ê°€';
        document.getElementById('btn-add-rm').classList.remove('btn-primary', 'btn-dark'); 
        document.getElementById('btn-add-rm').classList.add('btn-primary');
        document.getElementById('btn-cancel-rm').style.display = 'none';
        document.getElementById('rm-input-box').classList.remove('edit-mode');
        renderRoadmapView();
    }
    function addManualRoadmap() {
        const name = document.getElementById('rm-name').value;
        const start = parseInt(document.getElementById('rm-start').value);
        const end = parseInt(document.getElementById('rm-end').value);
        const desc = document.getElementById('rm-desc').value;
        const align = document.getElementById('rm-align').value; 
        if(!name) return alert("í•­ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”");
        if(end < start) return alert("ì¢…ë£Œ ì‹œì ì´ ì‹œì‘ ì‹œì ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        const duration = end - start + 1;
        const newItem = { name: name, start: start, duration: duration, desc: desc, align: align };
        if(editIndex > -1) { tempRoadmap[editIndex] = newItem; alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); } else { tempRoadmap.push(newItem); }
        resetRoadmapInput(); 
    }
    function loadRoadmapItemForEdit(idx) {
        if(document.querySelector('.rm-item-chip.dragging')) return;
        if(!confirm("ì´ í•­ëª©ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‚´ìš©ì´ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™ë©ë‹ˆë‹¤.")) return;
        const item = tempRoadmap[idx];
        document.getElementById('rm-name').value = item.name;
        document.getElementById('rm-start').value = item.start;
        document.getElementById('rm-end').value = item.start + item.duration - 1;
        document.getElementById('rm-desc').value = item.desc || '';
        document.getElementById('rm-align').value = item.align || 'center'; 
        editIndex = idx;
        document.getElementById('btn-add-rm').innerHTML = '<i class="fa-solid fa-check"></i> ìˆ˜ì • ì €ì¥';
        document.getElementById('btn-add-rm').classList.remove('btn-primary');
        document.getElementById('btn-add-rm').classList.add('btn-dark'); 
        document.getElementById('btn-cancel-rm').style.display = 'block';
        document.getElementById('rm-input-box').classList.add('edit-mode');
        document.getElementById('rm-toolbar').scrollIntoView({behavior: 'smooth'});
        document.getElementById('rm-name').focus();
    }
    function removeRoadmapItem(idx) {
        if(confirm("ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            tempRoadmap.splice(idx, 1);
            if(editIndex === idx) resetRoadmapInput(); 
            else if(editIndex > idx) editIndex--; 
            renderRoadmapView();
        }
    }
    function handleDragStart(e, idx) { dragSrcIndex = idx; dragSrcEl = e.target; e.target.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/html', e.target.innerHTML); }
    function handleDragOver(e) { if (e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect = 'move'; const target = e.target.closest('.rm-item-chip'); if (target && target !== dragSrcEl) { document.querySelectorAll('.rm-item-chip').forEach(el => el.classList.remove('drag-over')); target.classList.add('drag-over'); } return false; }
    function handleDragLeave(e) { const target = e.target.closest('.rm-item-chip'); if (target) target.classList.remove('drag-over'); }
    function handleDrop(e, dropIndex) { if (e.stopPropagation) e.stopPropagation(); const target = e.target.closest('.rm-item-chip'); if (dragSrcIndex !== dropIndex) { const movedItem = tempRoadmap[dragSrcIndex]; tempRoadmap.splice(dragSrcIndex, 1); tempRoadmap.splice(dropIndex, 0, movedItem); resetRoadmapInput(); renderRoadmapView(); } return false; }
    function handleDragEnd(e) { document.querySelectorAll('.rm-item-chip').forEach(el => { el.classList.remove('dragging'); el.classList.remove('drag-over'); }); }
    function renderRoadmapView() {
        const tbody = document.getElementById('rm-body');
        const listDiv = document.getElementById('rm-list');
        const headerRow1 = document.getElementById('rm-header-row-1');
        const headerRow2 = document.getElementById('rm-header-row-2');
        tbody.innerHTML = ''; listDiv.innerHTML = '';
        let maxMonthIdx = 12; 
        tempRoadmap.forEach(i => { if(i.start + i.duration - 1 > maxMonthIdx) maxMonthIdx = i.start + i.duration - 1; });
        const totalYears = Math.ceil(maxMonthIdx / 12);
        const baseYear = 2026;
        let h1 = `<th class="rm-header rm-diagonal" style="width:120px;" rowspan="2"><span class="rm-diagonal-text rm-text-bottom-left">í•­ëª©</span><span class="rm-diagonal-text rm-text-top-right">ì¼ì •</span></th>`;
        let h2 = '';
        for(let y=0; y<totalYears; y++) { h1 += `<th class="rm-header" colspan="12">${baseYear + y}</th>`; for(let m=1; m<=12; m++) h2 += `<th class="rm-subheader">${m}</th>`; }
        headerRow1.innerHTML = h1; headerRow2.innerHTML = h2;
        if(tempRoadmap.length === 0) { listDiv.innerHTML = '<div style="text-align:center; color:#94a3b8; font-size:12px;">ì¶”ê°€ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. í•­ëª©ì„ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>'; } 
        else {
            tempRoadmap.forEach((item, idx) => {
                const chip = document.createElement('div');
                chip.className = 'rm-item-chip'; chip.draggable = true;
                chip.innerHTML = `<i class="fa-solid fa-grip-vertical" style="color:#94a3b8; margin-right:5px; cursor:grab;"></i><span style="font-weight:bold; color:#334155;">${item.name}</span><i class="fa-solid fa-xmark" style="color:#ef4444; margin-left:8px; opacity:0.6; cursor:pointer;" title="ì‚­ì œ"></i>`;
                chip.addEventListener('dragstart', (e) => handleDragStart(e, idx)); chip.addEventListener('dragover', handleDragOver); chip.addEventListener('dragleave', handleDragLeave); chip.addEventListener('drop', (e) => handleDrop(e, idx)); chip.addEventListener('dragend', handleDragEnd);
                chip.onclick = () => loadRoadmapItemForEdit(idx);
                chip.querySelector('.fa-xmark').onclick = (e) => { e.stopPropagation(); removeRoadmapItem(idx); };
                listDiv.appendChild(chip);
            });
        }
        if(tempRoadmap.length === 0) { tbody.innerHTML = `<tr><td colspan="${1 + (totalYears*12)}" style="text-align:center; padding:20px; color:#cbd5e1;">ì¼ì •í‘œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</td></tr>`; return; }
        tempRoadmap.forEach((item, idx) => {
            let tr = '<tr>';
            const colorIdx = Math.min(idx, 5); const colorHex = colorPalette[colorIdx];
            const catTextColor = (colorIdx >= 4) ? '#1e293b' : 'white'; const catTextShadow = (colorIdx >= 4) ? 'none' : '0 1px 2px rgba(0,0,0,0.2)';
            tr += `<td class="rm-cat-col" onclick="loadRoadmapItemForEdit(${idx})" style="background-color:${colorHex}; border-color:${colorHex}; color:${catTextColor}; text-shadow:${catTextShadow}; cursor:pointer;">${item.name}</td>`;
            const totalCols = totalYears * 12;
            for(let i=1; i<=totalCols; i++) {
                if(i === item.start) {
                    const descText = item.desc ? item.desc.replace(/\/\//g, '<br>') : '';
                    const align = item.align || 'center';
                    let contentHtml = '';
                    if(align === 'out') { contentHtml = `<div class="rm-bar-container" onclick="loadRoadmapItemForEdit(${idx})" style="width:100%; background:${colorHex}; opacity:1;"></div><div class="rm-bar-outer-text" onclick="loadRoadmapItemForEdit(${idx})">${descText}</div>`; } 
                    else { const textColor = (colorIdx >= 4) ? '#1e293b' : 'white'; const textShadow = (colorIdx >= 4) ? 'none' : '0 1px 2px rgba(0,0,0,0.3)'; contentHtml = `<div class="rm-bar-container rm-align-${align}" onclick="loadRoadmapItemForEdit(${idx})" style="width:100%; background:${colorHex}; opacity:1; color:${textColor}; text-shadow:${textShadow};"><span class="rm-bar-desc">${descText}</span></div>`; }
                    tr += `<td class="rm-cell" colspan="${item.duration}" style="border-right:none; z-index:1; overflow:visible;">${contentHtml}</td>`;
                    i += (item.duration - 1); 
                } else { tr += `<td class="rm-cell"></td>`; }
            }
            tr += '</tr>'; tbody.innerHTML += tr;
        });
    }
    function saveRoadmap() { const currentData = dbList.find(d => d.id == currentId); if(currentData) { currentData.roadmap = tempRoadmap; saveData(); } closeRoadmapPopup(); }
    function printRoadmap() {
        const content = document.getElementById('roadmap-print-area').innerHTML;
        const printWindow = window.open('', '', 'width=1200,height=900');
        const styles = document.querySelector('style').innerHTML;
        printWindow.document.write('<!DOCTYPE html><html><head><title>Consulting Roadmap</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">');
        printWindow.document.write(`<style>${styles} @media print { body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; } @page { size: A4 landscape; margin: 5mm; } } body { margin: 0; padding: 10px; font-family: 'Pretendard', sans-serif; background: white; } .rm-table { width: 100%; table-layout: fixed; } #roadmap-print-area { width: 100%; zoom: 0.9; } ::-webkit-scrollbar { display: none; }</style>`);
        printWindow.document.write('</head><body>'); printWindow.document.write('<div id="roadmap-print-area">' + content + '</div>'); printWindow.document.write('</body></html>');
        printWindow.document.close(); printWindow.focus();
        setTimeout(() => { printWindow.print(); printWindow.close(); }, 500);
    }
    function openModal(id) {
        document.getElementById('modal').style.display = 'flex';
        currentId = id || null;
        isAdminLogAdded = false;
        
        const inputConsulting = document.getElementById('input-consulting');
        
        if(currentId) {
            const d = dbList.find(x => x.id == id);
            if(currentUser.role !== 'admin' && d.hasAdminAlert) { 
                d.hasAdminAlert = false; 
                renderList(); 
            }
            document.getElementById('edit-id').value = d.id;
            document.getElementById('display-member').innerText = d.member;
            document.getElementById('input-date').value = d.date;
            document.getElementById('input-source').value = d.source;
            document.getElementById('input-grade-prov').value = d.gradeProv || 'A';
            document.getElementById('input-company').value = d.company;
            document.getElementById('input-ceo').value = d.ceo || '';
            document.getElementById('input-phone').value = d.phone || '';
            document.getElementById('input-industry').value = d.industry || '';
            document.getElementById('input-revenue').value = d.revenue || 'ë¯¸í™•ì¸';
            document.getElementById('input-credit').value = d.credit || '';
            document.getElementById('input-annual-rev').value = d.annualRev ? d.annualRev.toLocaleString() : '';
            document.getElementById('input-tax').value = d.tax || 'ì™„ë‚©';
            document.getElementById('input-region').value = d.region || '';
            document.getElementById('input-meet-date').value = d.meetDate || '';
            document.getElementById('input-status').value = d.status;
            document.getElementById('input-wait-reason').value = d.waitReason || '';
            document.getElementById('input-ing-detail').value = d.ingDetail || '';
            document.getElementById('input-prospect-detail').value = d.prospectDetail || '';
            document.getElementById('input-end-reason').value = d.endReason || '';
            document.getElementById('input-product').value = d.product || '';
            document.getElementById('input-amount').value = d.totalAmount ? d.totalAmount.toLocaleString() : '';
            document.getElementById('input-consulting').value = d.consulting || '';
            
            if(d.consultingWidth) inputConsulting.style.width = d.consultingWidth + 'px';
            else inputConsulting.style.width = '100%';
            if(d.consultingHeight) inputConsulting.style.height = d.consultingHeight + 'px';
            else inputConsulting.style.height = 'auto';

            updateShareFields(); 
            if(d.shareList && Array.isArray(d.shareList)) { d.shareList.forEach((s, idx) => { const i = idx + 1; if(i <= 3) { document.getElementById(`share-partner-${i}`).value = s.partner; document.getElementById(`share-percent-${i}`).value = s.percent; } }); } 
            else if (d.shareInfo) { if(d.shareInfo.partner) { document.getElementById('share-partner-1').value = d.shareInfo.partner; document.getElementById('share-percent-1').value = d.shareInfo.percent; } }
            tempLogs = d.logs || [];
            tempRoadmap = d.roadmap || [];
        } else {
            // [â˜…ì¤‘ìš”] ì‹ ê·œ ë“±ë¡ ì‹œ ëª¨ë“  í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('edit-id').value = '';
            document.getElementById('display-member').innerText = currentUser.name;
            document.getElementById('input-date').valueAsDate = new Date();
            
            document.getElementById('input-source').value = 'íšŒì‚¬DB';
            document.getElementById('input-grade-prov').value = 'A';
            document.getElementById('input-company').value = '';
            document.getElementById('input-ceo').value = '';
            document.getElementById('input-phone').value = '';
            document.getElementById('input-industry').value = '';
            document.getElementById('input-revenue').value = 'ë¯¸í™•ì¸';
            document.getElementById('input-credit').value = '';
            document.getElementById('input-annual-rev').value = '';
            document.getElementById('input-tax').value = 'ì™„ë‚©';
            document.getElementById('input-region').value = '';
            document.getElementById('input-meet-date').value = '';
            
            document.getElementById('input-status').value = 'ëŒ€ê¸°';
            document.getElementById('input-wait-reason').value = '';
            document.getElementById('input-ing-detail').value = '';
            document.getElementById('input-prospect-detail').value = '';
            document.getElementById('input-end-reason').value = '';
            
            document.getElementById('input-product').value = '';
            document.getElementById('input-amount').value = '';
            document.getElementById('input-consulting').value = '';
            
            inputConsulting.style.width = '100%';
            inputConsulting.style.height = 'auto';
            
            updateShareFields(); 
            [1,2,3].forEach(i => { 
                document.getElementById(`share-partner-${i}`).value = ''; 
                document.getElementById(`share-percent-${i}`).value = ''; 
            });
            calculateShare();
            
            tempLogs = [];
            tempRoadmap = [];
        }
        toggleGradeField(); toggleStatusFields(); renderLogs();
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function logout() { location.reload(); }
    function changePassword() {
        if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        const newPw = prompt("ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if(newPw) {
            userCreds = JSON.parse(localStorage.getItem('dbProCreds')) || {};
            userCreds[currentUser.name] = newPw;
            localStorage.setItem('dbProCreds', JSON.stringify(userCreds));
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ìŒì— ì´ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
        }
    }
    function formatCurrency(input) { input.value = (parseInt(input.value.replace(/,/g,''))||0).toLocaleString(); }
    function addLog() { const t = document.getElementById('hist-input').value; if(t) { const writer = currentUser.name; tempLogs.unshift({time:new Date().toLocaleString(), text:t, writer:writer}); renderLogs(); document.getElementById('hist-input').value=''; if(currentUser.role === 'admin') isAdminLogAdded = true; } }
    function renderLogs() { document.getElementById('log-list').innerHTML = tempLogs.map(l => { const writerStr = l.writer ? `<b>${l.writer}</b>: ` : ''; return `<div style="font-size:12px; border-bottom:1px solid #eee; padding:5px;">[${l.time}] ${writerStr}${l.text}</div>`; }).join(''); }
    
    function saveData() {
        if(!GAS_URL || GAS_URL.includes('URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”')) {
            alert('êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }

        const id = document.getElementById('edit-id').value || Date.now(); 
        const total = parseInt(document.getElementById('input-amount').value.replace(/,/g,''))||0;
        let shareList = [];
        let totalDeduction = 0;
        for(let i=1; i<=3; i++) {
            const p = document.getElementById(`share-partner-${i}`).value;
            const pct = parseInt(document.getElementById(`share-percent-${i}`).value)||0;
            if(p && pct > 0) {
                let amt = Math.floor(total * (pct/100));
                shareList.push({ partner: p, percent: pct, amount: amt, step: i });
                totalDeduction += amt;
            }
        }
        let existingData = dbList.find(x => x.id == id) || {};
        const memberName = document.getElementById('display-member').innerText;
        const companyName = document.getElementById('input-company').value;
        const inputConsulting = document.getElementById('input-consulting');
        
        const obj = {
            id: id, member: memberName, date: document.getElementById('input-date').value, source: document.getElementById('input-source').value, gradeProv: document.getElementById('input-grade-prov').value, company: companyName, ceo: document.getElementById('input-ceo').value, phone: document.getElementById('input-phone').value, industry: document.getElementById('input-industry').value, revenue: document.getElementById('input-revenue').value, credit: document.getElementById('input-credit').value, annualRev: parseInt(document.getElementById('input-annual-rev').value.replace(/,/g,''))||0, tax: document.getElementById('input-tax').value, region: document.getElementById('input-region').value, meetDate: document.getElementById('input-meet-date').value, status: document.getElementById('input-status').value, waitReason: document.getElementById('input-wait-reason').value, ingDetail: document.getElementById('input-ing-detail').value, prospectDetail: document.getElementById('input-prospect-detail').value, endReason: document.getElementById('input-end-reason').value, product: document.getElementById('input-product').value, totalAmount: total, amount: total - totalDeduction, shareList: shareList, consulting: document.getElementById('input-consulting').value, 
            
            consultingWidth: inputConsulting.offsetWidth,
            consultingHeight: inputConsulting.offsetHeight,
            
            logs: tempLogs, roadmap: tempRoadmap, hasAdminAlert: (currentUser.role === 'admin' && isAdminLogAdded) ? true : (existingData.hasAdminAlert || false)
        };

        showLoading();

        fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'save', data: obj })
        })
        .then(res => res.json())
        .then(res => {
            hideLoading();
            alert('DBì •ë³´ ì €ì¥ ì™„ë£Œ');
            closeModal();
            fetchDB(() => { 
                if(currentUser.role==='admin' && document.getElementById('view-dashboard').style.display === 'block') renderAdminDashboard();
                else renderList();
            });
        })
        .catch(err => {
            hideLoading();
            alert('ì €ì¥ ì‹¤íŒ¨: ' + err);
        });
    }
    
    function deleteData() {
        if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)')) return;
        const id = document.getElementById('edit-id').value;
        
        showLoading();
        fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'delete', id: id })
        })
        .then(res => res.json())
        .then(res => {
            hideLoading();
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal();
            fetchDB(() => { renderList(); });
        })
        .catch(err => {
            hideLoading();
            alert('ì‚­ì œ ì‹¤íŒ¨: ' + err);
        });
    }

    function renderAnalysisData() { renderYoYSummaryTable(); renderYoYDetail(); renderMonthlyKPI(); }
    function renderYoYSummaryTable() { const tbody = document.querySelector('#yoy-summary-table tbody'); tbody.innerHTML = ''; const thisY = new Date().getFullYear(); let list = members.filter(m=>m!=='ê´€ë¦¬ì').map(m => { const myDB = dbList.filter(d=>d.member===m && d.status==='ê³„ì•½'); const l = myDB.filter(d => parseInt(d.date.split('-')[0]) === thisY-1).reduce((a,c)=>a+(parseInt(c.amount)||0),0); const t = myDB.filter(d => parseInt(d.date.split('-')[0]) === thisY).reduce((a,c)=>a+(parseInt(c.amount)||0),0); return {name:m, last:l, this:t}; }).sort((a,b)=>b.this-a.this); list.forEach((d,i)=>{ tbody.innerHTML+=`<tr><td>${i+1}</td><td>${d.name}</td><td>${d.last.toLocaleString()}</td><td>${d.this.toLocaleString()}</td><td>${(d.this-d.last).toLocaleString()}</td><td>${d.last>0?Math.round((d.this-d.last)/d.last*100):0}%</td></tr>`; }); }
    function renderYoYDetail() { const thisY = new Date().getFullYear(); const lastY = thisY - 1; const thisData = Array(12).fill(0); const lastData = Array(12).fill(0); let targetDB = (currentUser.role === 'admin') ? dbList : dbList.filter(d => d.member === currentUser.name); targetDB.forEach(d => { if(d.status !== 'ê³„ì•½') return; const y = parseInt(d.date.split('-')[0]); const m = parseInt(d.date.split('-')[1]) - 1; if(y === thisY) thisData[m] += (d.amount || 0); if(y === lastY) lastData[m] += (d.amount || 0); }); const thisTotal = thisData.reduce((a,b)=>a+b,0); const lastTotal = lastData.reduce((a,b)=>a+b,0); document.getElementById('val-last-total').innerText = lastTotal.toLocaleString(); document.getElementById('val-this-total').innerText = thisTotal.toLocaleString(); document.getElementById('val-growth').innerText = (thisTotal - lastTotal).toLocaleString(); let html = `<tr><td>${lastY}ë…„</td>`; lastData.forEach(v => html += `<td>${v.toLocaleString()}</td>`); html += `<td style="font-weight:bold">${lastTotal.toLocaleString()}</td></tr>`; html += `<tr style="background:#eff6ff"><td>${thisY}ë…„</td>`; thisData.forEach(v => html += `<td>${v.toLocaleString()}</td>`); html += `<td style="font-weight:bold; color:blue">${thisTotal.toLocaleString()}</td></tr>`; document.getElementById('yoy-detail-body').innerHTML = html; }
    
    function renderMonthlyKPI() {
        const ty = new Date().getFullYear();
        let d = (currentUser.role === 'admin') ? dbList : dbList.filter(x => x.member === currentUser.name);
        d = d.filter(x => parseInt(x.date.split('-')[0]) === ty && x.status === 'ê³„ì•½'); 

        const sources = ['íšŒì‚¬DB', 'ê°œì¸DB', 'íŒ€DB', 'ê¸°íƒ€DB', 'ì‰ì–´ë°›ìŒ'];
        const data = {};
        sources.forEach(s => {
            data[s] = Array(12).fill().map(() => ({ cnt: 0, amt: 0 }));
        });

        d.forEach(x => {
            const m = parseInt(x.date.split('-')[1]) - 1;
            let src = x.source || ""; 
            if(src.includes('ì‰ì–´')) src = 'ì‰ì–´ë°›ìŒ';
            else if(!sources.includes(src)) src = 'ê¸°íƒ€DB';
            if(data[src]) {
                data[src][m].cnt++;
                data[src][m].amt += (parseInt(x.amount) || 0);
            }
        });

        const tb = document.getElementById('month-kpi-table').querySelector('tbody');
        tb.innerHTML = '';
        sources.forEach(src => {
            let rowHtml = `<td style="font-weight:bold">${src}</td>`;
            let totalCnt = 0;
            let totalAmt = 0;
            for(let i=0; i<12; i++) {
                const c = data[src][i].cnt;
                const a = data[src][i].amt;
                totalCnt += c;
                totalAmt += a;
                rowHtml += `<td>${c > 0 ? `<b>${c}</b><br><span style="font-size:10px; color:#2563eb">${(a/10000).toLocaleString()}ë§Œ</span>` : '<span style="color:#eee">-</span>'}</td>`;
            }
            rowHtml += `<td style="background:#f1f5f9; font-weight:bold;">${totalCnt}ê±´<br><span style="color:#2563eb">${(totalAmt/10000).toLocaleString()}ë§Œ</span></td>`;
            tb.innerHTML += `<tr>${rowHtml}</tr>`;
        });
    }

    function renderHistory() { const y = document.getElementById('hist-year').value; const m = document.getElementById('hist-month').value; const tbody = document.getElementById('history-body'); const thead = document.getElementById('history-head'); tbody.innerHTML = ''; if(currentUser.role === 'admin') { if(historyTab === 'admin-prospect') thead.innerHTML = `<tr><th>ì ‘ìˆ˜ì¼</th><th>ë‹´ë‹¹ì</th><th>ì—…ì²´ëª…</th><th>DBì¶œì²˜</th><th>í˜„ì¬ìƒíƒœ</th></tr>`; else thead.innerHTML = `<tr><th>ê³„ì•½ì¼</th><th>ë‹´ë‹¹ì</th><th>ì—…ì²´ëª…</th><th>ìƒí’ˆ</th><th>ë§¤ì¶œ(ìˆœìˆ˜ìµ)</th></tr>`; } else { if(historyTab === 'prospect') thead.innerHTML = `<tr><th>ì ‘ìˆ˜ì¼</th><th>ë¯¸íŒ…ì¼</th><th>ì—…ì²´ëª…</th><th>ì¶œì²˜</th><th>í˜„ì¬ìƒíƒœ</th></tr>`; else thead.innerHTML = `<tr><th>ê³„ì•½ì¼</th><th>ë‹´ë‹¹ì</th><th>ì—…ì²´ëª…</th><th>ìƒí’ˆ</th><th>ë§¤ì¶œ(ìˆœìˆ˜ìµ)</th></tr>`; } const list = dbList.filter(d => { const dYear = parseInt(d.date.split('-')[0]); const dMonth = parseInt(d.date.split('-')[1]); if(dYear != y) return false; if(m !== 'all' && dMonth != m) return false; if(currentUser.role === 'admin') { if(historyTab === 'admin-prospect') return d.status === 'ê°€ë§ê³ ê°'; if(historyTab === 'contract') return d.status === 'ê³„ì•½'; } else { if(d.member !== currentUser.name) return false; if(historyTab === 'prospect') return d.status === 'ê°€ë§ê³ ê°' && !d.source.includes('ì‰ì–´'); if(historyTab === 'contract') return d.status === 'ê³„ì•½'; } return false; }); if(list.length === 0) { tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:30px;">ê¸°ë¡ ë‚´ìš© ì—†ìŒ</td></tr>'; return; } list.forEach(d => { let row = ''; if(currentUser.role === 'admin') { if(historyTab === 'admin-prospect') row = `<td>${d.date}</td><td>${d.member}</td><td style="font-weight:bold">${d.company}</td><td style="color:blue">${d.source}</td><td><span class="badge status-prospect">${d.status}</span></td>`; else row = `<td>${d.date}</td><td>${d.member}</td><td style="font-weight:bold">${d.company}</td><td>${d.product||'-'}</td><td style="color:blue">${(d.amount||0).toLocaleString()}</td>`; } else { if(historyTab === 'prospect') row = `<td>${d.date}</td><td>${d.meetDate||'-'}</td><td style="font-weight:bold">${d.company}</td><td>${d.source}</td><td><span class="badge status-prospect">${d.status}</span></td>`; else row = `<td>${d.date}</td><td>${d.member}</td><td style="font-weight:bold">${d.company}</td><td>${d.product||'-'}</td><td style="color:blue">${(d.amount||0).toLocaleString()}</td>`; } tbody.innerHTML += `<tr onclick="openModal('${d.id}')">${row}</tr>`; }); }
    function renderAdminDashboard() { const now = new Date(); const selectedMonth = document.getElementById('admin-stat-month').value; const targetYear = now.getFullYear(); const targetMonth = (selectedMonth === 'all') ? (now.getMonth() + 1) : parseInt(selectedMonth); const monthlyData = dbList.filter(d => { const dDate = new Date(d.date); return dDate.getFullYear() === targetYear && (dDate.getMonth() + 1) === targetMonth; }); const totalDB = monthlyData.length; const contracts = monthlyData.filter(d => d.status === 'ê³„ì•½'); const totalRevenue = contracts.reduce((acc, curr) => acc + (parseInt(curr.amount)||0), 0); const convRate = totalDB > 0 ? ((contracts.length / totalDB) * 100).toFixed(1) : 0; document.getElementById('ad-total-rev').innerText = totalRevenue.toLocaleString() + "ì›"; document.getElementById('ad-total-cont').innerText = contracts.length + "ê±´"; document.getElementById('ad-total-db').innerText = totalDB + "ê°œ"; document.getElementById('ad-conv-rate').innerText = convRate + "%"; const stats = {}; contracts.forEach(d => { if(!stats[d.member]) stats[d.member] = 0; stats[d.member] += (d.amount || 0); }); const sorted = Object.entries(stats).sort((a,b) => b[1] - a[1]); const r500 = sorted.filter(x => x[1] >= 5000000); const r300 = sorted.filter(x => x[1] >= 3000000 && x[1] < 5000000); const r60 = sorted.filter(x => x[1] >= 600000 && x[1] < 3000000); function fillList(id, arr) { const el = document.getElementById(id); el.innerHTML = ''; if(arr.length === 0) el.innerHTML = '<li style="padding:10px; color:#999; text-align:center;">ë‹¬ì„±ì ì—†ìŒ</li>'; arr.forEach(x => { el.innerHTML += `<li class="rank-item"><span>${x[0]}</span> <span class="rank-val">${x[1].toLocaleString()}</span></li>`; }); } fillList('rank-500', r500); fillList('rank-300', r300); fillList('rank-60', r60); const tbody = document.getElementById('team-status-body'); tbody.innerHTML = ''; const teamStats = members.filter(m => m !== 'ê´€ë¦¬ì').map(m => { const myData = monthlyData.filter(d => d.member === m); const dbCount = myData.length; const meetCount = myData.reduce((acc,curr) => acc + (curr.logs ? curr.logs.length : 0), 0); const prospectCount = myData.filter(d => d.status === 'ê°€ë§ê³ ê°').length; const contCount = myData.filter(d => d.status === 'ê³„ì•½').length; const rev = myData.filter(d => d.status === 'ê³„ì•½').reduce((a,c) => a + (c.amount||0), 0); const rate = dbCount > 0 ? Math.round((contCount/dbCount)*100) : 0; return { name: m, db: dbCount, meet: meetCount, prospect: prospectCount, cont: contCount, rev: rev, rate: rate }; }).sort((a,b) => b.rev - a.rev); teamStats.forEach((s, idx) => { const maxRev = teamStats[0].rev || 1; const barWidth = Math.max(5, (s.rev / maxRev) * 100); tbody.innerHTML += `<tr style="height:50px;"><td style="font-weight:bold;">${idx+1}</td><td>${s.name}</td><td>${s.db}</td><td>${s.meet}</td><td style="color:var(--prospect); font-weight:bold;">${s.prospect}</td><td style="color:#10b981; font-weight:bold;">${s.cont}</td><td>${s.rate}%</td><td><div style="font-weight:bold; color:var(--primary);">${s.rev.toLocaleString()}</div><div class="progress-bar-bg"><div class="progress-bar-fill" style="width:${barWidth}%"></div></div></td><td>${s.rev >= 5000000 ? 'ğŸ”¥' : '-'}</td></tr>`; }); }
</script>
</body>
</html>
